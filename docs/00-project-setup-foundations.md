# LangChain å®æˆ˜å¼€å‘æ•™ç¨‹ï¼ˆä¸€ï¼‰ï¼šé¡¹ç›®å·¥ç¨‹æ­å»ºä¸åŸºç¡€å¯¹è¯

> **ä½œè€…**ï¼šä¸€ç°ç°  
> **æ›´æ–°æ—¶é—´**ï¼š2026å¹´2æœˆ  
> **é€‚ç”¨åœºæ™¯**ï¼šPython å¼€å‘è€…ã€AI åº”ç”¨åˆå­¦è€…ã€LangChain å…¥é—¨å­¦ä¹ è€…

## ğŸ¯ æœ¬æ–‡ç›®æ ‡

ä»é›¶å¼€å§‹æ­å»ºä¸€ä¸ªåŸºäº LangChain çš„æ™ºèƒ½å¯¹è¯é¡¹ç›®ï¼Œè®©ä½ ä½“éªŒï¼š

- ç°ä»£åŒ–çš„ Python é¡¹ç›®å·¥ç¨‹åŒ–å®è·µ
- OpenAI é£æ ¼çš„å¤§æ¨¡å‹ API è°ƒç”¨
- åŒæ­¥ä¸æµå¼ä¸¤ç§ä¸åŒçš„é—®ç­”ä½“éªŒ
- å®‰å…¨çš„é…ç½®ç®¡ç†æ–¹å¼

## ğŸ“š ä½ å°†å­¦åˆ°ä»€ä¹ˆï¼Ÿ

é€šè¿‡æœ¬æ–‡å®è·µï¼Œä½ å°†æŒæ¡ï¼š

1. **é¡¹ç›®åˆå§‹åŒ–**ï¼šä½¿ç”¨ uv æ„å»ºç°ä»£åŒ– Python é¡¹ç›®
2. **ä¾èµ–ç®¡ç†**ï¼šå®‰å…¨é«˜æ•ˆçš„åŒ…ç®¡ç†ç­–ç•¥
3. **é…ç½®åˆ†ç¦»**ï¼šæ•æ„Ÿä¿¡æ¯çš„ä¼˜é›…å¤„ç†æ–¹å¼
4. **æ¨¡å‹æ¥å…¥**ï¼šç»Ÿä¸€æ¥å£è°ƒç”¨ä¸åŒå¤§è¯­è¨€æ¨¡å‹
5. **äº¤äº’ä¼˜åŒ–**ï¼šåŒæ­¥ vs æµå¼çš„ç”¨æˆ·ä½“éªŒå·®å¼‚

## ğŸ› ï¸ ç¬¬ä¸€æ­¥ï¼šé¡¹ç›®ç¯å¢ƒå‡†å¤‡

### 1.1 Python ç¯å¢ƒè¦æ±‚

ç¡®ä¿ä½ çš„ç³»ç»Ÿæ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š

```bash
# æ£€æŸ¥ Python ç‰ˆæœ¬ï¼ˆéœ€è¦ â‰¥ 3.10ï¼‰
python --version

# æ£€æŸ¥ uv æ˜¯å¦å®‰è£…
uv --version
```

### 1.2 é¡¹ç›®ç›®å½•ç»“æ„è®¾è®¡

```
langchain-demo/
â”œâ”€â”€ basic00/           # æ ¸å¿ƒä»£ç ç›®å½•
â”‚   â””â”€â”€ SimpleChat.py  # ä¸»è¦ç¤ºä¾‹ä»£ç 
â”œâ”€â”€ docs/              # æ–‡æ¡£ç›®å½•
â”‚   â””â”€â”€ 01-langchain-project-setup.md  # æœ¬æ–‡æ¡£
â”œâ”€â”€ config.env         # é…ç½®æ–‡ä»¶ï¼ˆæ•æ„Ÿä¿¡æ¯ï¼‰
â”œâ”€â”€ pyproject.toml     # é¡¹ç›®é…ç½®æ–‡ä»¶
â”œâ”€â”€ uv.lock           # ä¾èµ–é”å®šæ–‡ä»¶
â””â”€â”€ README.md         # é¡¹ç›®è¯´æ˜
```

**è®¾è®¡åŸåˆ™**ï¼š

- é…ç½®ä¸ä»£ç åˆ†ç¦»ï¼Œä¾¿äºå¤šç¯å¢ƒéƒ¨ç½²
- ä½¿ç”¨ç°ä»£åŒ…ç®¡ç†å·¥å…·æå‡å¼€å‘æ•ˆç‡
- æ ‡å‡†åŒ–ç›®å½•ç»“æ„ï¼Œæé«˜å›¢é˜Ÿåä½œæ•ˆç‡

## ğŸ“¦ ç¬¬äºŒæ­¥ï¼šä¾èµ–ç®¡ç†ä¸å®‰è£…

### 2.1 ä½¿ç”¨ uv åˆå§‹åŒ–é¡¹ç›®

```bash
# å®‰è£… uvï¼ˆå¦‚æœå°šæœªå®‰è£…ï¼‰
pip install uv

# åˆ›å»ºé¡¹ç›®é…ç½®æ–‡ä»¶
uv init
```

### 2.2 é…ç½® pyproject.toml

åˆ›å»º `pyproject.toml` æ–‡ä»¶ï¼š

```toml
[project]
name = "langchain-demo"
version = "0.1.0"
description = "LangChain å®æˆ˜é¡¹ç›®"
requires-python = ">=3.10"
dependencies = [
    "langchain-openai>=1.1.7",
    "python-dotenv>=1.2.1",
]

[dependency-groups]
dev = [
    "pytest>=7.0.0",
    "black>=23.0.0",
    "flake8>=6.0.0",
]
```

### 2.3 å®‰è£…ä¾èµ–

```bash
# åŒæ­¥å®‰è£…æ‰€æœ‰ä¾èµ–
uv sync

# éªŒè¯å®‰è£…ç»“æœ
uv run python -c "import langchain_openai; print('âœ… LangChain å®‰è£…æˆåŠŸ')"
```

## âš™ï¸ ç¬¬ä¸‰æ­¥ï¼šé…ç½®æ–‡ä»¶ç®¡ç†

### 3.1 åˆ›å»ºé…ç½®æ–‡ä»¶

> æˆ‘ä»¬è¿™é‡Œä½¿ç”¨ç¡…åŸºæµåŠ¨æä¾›çš„å…è´¹æ¨¡å‹æ¥ä½“éªŒå¤§æ¨¡å‹çš„äº¤äº’èƒ½åŠ›,å› æ­¤éœ€è¦å°ä¼™ä¼´åˆ°å®˜ç½‘æ³¨å†Œè´¦å·ã€ç”³è¯·ApiKey

åˆ›å»º `config.env` æ–‡ä»¶ï¼š

```env
# API é…ç½®
API_KEY=sk-your-api-key-here
BASE_URL=https://api.siliconflow.cn/v1
MODEL=deepseek-ai/DeepSeek-R1-0528-Qwen3-8B

# å…¶ä»–é…ç½®é¡¹å¯ä»¥åœ¨æ­¤æ‰©å±•
DEBUG=true
LOG_LEVEL=INFO
```

### 3.2 é…ç½®æ–‡ä»¶å®‰å…¨å¤„ç†

åˆ›å»º `.gitignore` æ–‡ä»¶ä¿æŠ¤æ•æ„Ÿä¿¡æ¯ï¼š

```gitignore
# å¿½ç•¥é…ç½®æ–‡ä»¶
config.env
.env
*.env

# Python ç›¸å…³
__pycharm__
*.pyc
*.pyo
*.pyd
.Python
*.so
.coverage
.pytest_cache/

# ç¼–è¾‘å™¨ç›¸å…³
.vscode/
.idea/
*.swp
*.swo

# ç³»ç»Ÿæ–‡ä»¶
.DS_Store
Thumbs.db
```

### 3.3 ç¯å¢ƒå˜é‡åŠ è½½ä»£ç 

```python
import os
from dotenv import load_dotenv

# æ™ºèƒ½è·¯å¾„æŸ¥æ‰¾é…ç½®æ–‡ä»¶
config_path = os.path.join(os.path.dirname(os.path.dirname(__file__)), 'config.env')
load_dotenv(config_path)
```

## ğŸ¤– ç¬¬å››æ­¥ï¼šåŸºç¡€å¯¹è¯å®ç°

### 4.1 åŒæ­¥è°ƒç”¨æ¨¡å¼

```python
from langchain_openai import ChatOpenAI

# åˆå§‹åŒ–æ¨¡å‹å®¢æˆ·ç«¯
llm = ChatOpenAI(
    api_key=os.getenv('API_KEY'),
    base_url=os.getenv('BASE_URL'),
    model=os.getenv('MODEL'),
    stream_usage=True
)

# æ„é€ å¯¹è¯æ¶ˆæ¯
messages = [
    ("system", "ä½ æ˜¯ä¸€ä¸ªé¡¶çº§çš„å¹½é»˜å¤§å¸ˆï¼Œæ“…é•¿å„ç§ç½‘ç»œçƒ­æ¢—å’Œå¹½é»˜æ®µå­"),
    ("human", "æˆ‘æƒ³ä¸Šè¡—ä¹°ä¸ªå¸½å­")
]

# åŒæ­¥è°ƒç”¨
ai_msg = llm.invoke(messages)

# ç¾åŒ–è¾“å‡ºç»“æœ
print("=" * 60)
print("ğŸ¤– AI æ™ºèƒ½å›å¤")
print("=" * 60)
print(f"\nğŸ’¬ å›å¤å†…å®¹:\n{ai_msg.content}")
print("=" * 60)
```

**åŒæ­¥æ¨¡å¼ç‰¹ç‚¹**ï¼š

- âœ… ç®€å•ç›´è§‚ï¼Œé€‚åˆå¿«é€ŸåŸå‹å¼€å‘
- âœ… ä¸€æ¬¡æ€§è·å–å®Œæ•´å“åº”
- âŒ ç”¨æˆ·éœ€è¦ç­‰å¾…å®Œæ•´å“åº”æ‰èƒ½çœ‹åˆ°ç»“æœ
- âŒ æ— æ³•å®æ—¶æ„ŸçŸ¥æ¨¡å‹æ€è€ƒè¿‡ç¨‹

### 4.2 æµå¼è°ƒç”¨æ¨¡å¼

```python
# æµå¼è¿”å›å¤„ç†
print("\n" + "=" * 60)
print("ğŸ¤– AI æµå¼å›å¤ä¸­...")
print("=" * 60)

full_response = ""
# ä½¿ç”¨æµå¼æ–¹æ³•é€ä¸ªå¤„ç†è¿”å›çš„token
for chunk in llm.stream(messages):
    if hasattr(chunk, 'content') and chunk.content:
        print(chunk.content, end='', flush=True)
        full_response += chunk.content

print("\n" + "=" * 60)
print("ğŸ“Š è¯¦ç»†æŠ€æœ¯ä¿¡æ¯:")
print(f"  ğŸ“ æ¶ˆæ¯ç±»å‹: {type(chunk).__name__}")
if hasattr(chunk, 'usage_metadata') and chunk.usage_metadata:
    print(f"  ğŸ’° Token ä½¿ç”¨: {chunk.usage_metadata}")
else:
    print("  ğŸ’° Token ä½¿ç”¨: æœªæä¾›")
print("=" * 60)
```

**æµå¼æ¨¡å¼ç‰¹ç‚¹**ï¼š

- âœ… å®æ—¶å“åº”ï¼Œç”¨æˆ·ä½“éªŒæ›´å¥½
- âœ… å¯ä»¥å±•ç¤ºæ¨¡å‹çš„"æ€è€ƒ"è¿‡ç¨‹
- âœ… é€‚åˆé•¿æ–‡æœ¬ç”Ÿæˆåœºæ™¯
- âŒ ä»£ç å¤æ‚åº¦ç¨é«˜
- âŒ éœ€è¦è€ƒè™‘ä¸­æ–­å¤„ç†

## ğŸ¨ ç¬¬äº”æ­¥ï¼šè¾“å‡ºç¾åŒ–ä¸è°ƒè¯•ä¿¡æ¯

### 5.1 ç¾åŒ–è¾“å‡ºè®¾è®¡

```python
def pretty_print_ai_response(response, response_type="sync"):
    """ç¾åŒ–çš„ AI å“åº”è¾“å‡º"""
    separator = "=" * 60

    print(f"\n{separator}")
    if response_type == "stream":
        print("ğŸ¤– AI æµå¼å›å¤")
    else:
        print("ğŸ¤– AI æ™ºèƒ½å›å¤")
    print(separator)

    # ä¸»è¦å†…å®¹æ˜¾ç¤º
    print(f"\nğŸ’¬ å›å¤å†…å®¹:")
    if hasattr(response, 'content'):
        print(response.content)
    else:
        print(str(response))

    # æŠ€æœ¯ä¿¡æ¯
    print(f"\n{separator}")
    print("ğŸ“Š æŠ€æœ¯è¯¦æƒ…:")
    print(f"  ğŸ“ ç±»å‹: {type(response).__name__}")

    # Token ä½¿ç”¨æƒ…å†µ
    if hasattr(response, 'usage_metadata') and response.usage_metadata:
        print(f"  ğŸ’° Token: {response.usage_metadata}")
    elif hasattr(response, 'usage') and response.usage:
        print(f"  ğŸ’° Token: {response.usage}")
    else:
        print("  ğŸ’° Token: æœªæä¾›")

    # å¯¹è±¡å±æ€§ç»Ÿè®¡
    attr_count = len([attr for attr in dir(response) if not attr.startswith('_')])
    print(f"  ğŸ” å±æ€§æ•°: {attr_count} ä¸ª")
    print(separator)


# ä½¿ç”¨ç¤ºä¾‹
pretty_print_ai_response(ai_msg, "sync")
```

### 5.2 è°ƒè¯•ä¿¡æ¯çš„é‡è¦æ€§

é€šè¿‡è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥ï¼š

- äº†è§£æ¨¡å‹çš„å®é™…è°ƒç”¨æˆæœ¬
- ç›‘æ§ Token ä½¿ç”¨æƒ…å†µ
- åˆ†æå“åº”å¯¹è±¡çš„ç»“æ„ç‰¹å¾
- ä¸ºæ€§èƒ½ä¼˜åŒ–æä¾›æ•°æ®æ”¯æ’‘

## ğŸ”§ ç¬¬å…­æ­¥ï¼šé¡¹ç›®è¿è¡Œä¸éªŒè¯

### 6.1 è¿è¡Œé¡¹ç›®

```bash
# ä½¿ç”¨ uv è¿è¡Œé¡¹ç›®
uv run python basic00/HelloLangChain.py
```

### 6.2 é¢„æœŸè¾“å‡ºæ•ˆæœ

```
============================================================
ğŸ¤– AI æ™ºèƒ½å›å¤
============================================================

ğŸ’¬ å›å¤å†…å®¹:
é‚£å¾ˆå¥½ï¼ä¹°å•¥å¸½å­ä¸å¥½ï¼Œä¹°å››ä¸ªï¼ä¸€ä¸ªé®å¤©ï¼Œä¸€ä¸ªè”½æ—¥ï¼Œ
ä¸€ä¸ªé¡¶é£ï¼Œä¸€ä¸ªå¾€é‡Œï¼ä¿è¯ä½ ä»¥åèµ°åœ¨è¡—ä¸Šï¼Œåˆ«äººçœ‹è§ä½ å°±
æ˜¯ï¼š"oldå¤©å“ªï¼Œè¿™å“¥ä»¬å‘è´¢äº†ï¼"å“ˆå“ˆï¼Œä¸è¿‡å¸½å­è¿˜æ˜¯ä¹°ä¸€ä¸ªå§ï¼Œ
ä¸ç„¶å¤ª"ç»ç»å­"äº†å“¦ï¼

============================================================
ğŸ“Š è¯¦ç»†æŠ€æœ¯ä¿¡æ¯:
  ğŸ“ æ¶ˆæ¯ç±»å‹: AIMessage
  ğŸ’° Token ä½¿ç”¨: {'input_tokens': 36, 'output_tokens': 299, 'total_tokens': 335}
  ğŸ” å¯¹è±¡å±æ€§æ•°: 48 ä¸ª
============================================================

============================================================
ğŸ¤– AI æµå¼å›å¤ä¸­...
============================================================
æœ€è¿‘ä»€ä¹ˆé£é¡å°±ä¹°ä»€ä¹ˆå¸½å­ï¼é’»çŸ³çƒåœºé£ã€æ–°å† æˆ´å¸½é£ã€
å†°ä¸ç«ä¹‹å¸½ï¼è¦è¯´æœ€ç«çš„ï¼Œé‚£è‚¯å®šæ˜¯åº”æ´å¸½å­äº†ï¼Œä¹°å®Œç›´æ¥
åŒ–èº«å›½æ°‘åˆæ‹çš„ç‹‚çƒ­ç²‰â€”â€”å“¦ä¸ï¼Œæ˜¯ç½‘å‹ï¼
å½“ä½ æ‹’ç»äº†ä¸€é¡¶åº”æ´å¸½å­ï¼Œæ‘¸ç€ä½ çš„ç‹®å­å¤´ï¼ŒæƒŠæåœ°å‘ç°ï¼š
"å®Œäº†ï¼Œå¤´å‘ç§ƒäº†ï¼"â€”â€”æ²¡é”™ï¼Œä½ å¯èƒ½é…ä¸ä¸Šã€‚
è€Œä¸”ï¼Œä½ ä»¥ä¸ºè¦ä¹°å¸½å­é®ä¸‘ï¼Œæ²¡äººå‘ç°ï¼Œè°å®¶è§’æ–—å£«èµ°ä¸¤æ­¥
éƒ½ä¸å¥—ä¸ªå¤´ç›”ï¼Ÿ
è®°ä½ï¼Œå¸½å­æ°¸è¿œä¸æ˜¯è£…é¥°ï¼Œå®ƒæ˜¯ä¸€ç§å®£è¨€â€”â€”ä¸ç®¡ä½ å¤šå·ï¼Œ
éƒ½åˆ«å¿˜äº†é®é®ä½ é‚£é¢…é¡¶å±æœºå››ä¼çš„åœ°å¸¦ã€‚ä¸ç„¶å¤§æ¸…æ—©é¡¶ç€ä¸ª
é£æœºåœºå‡ºé—¨ï¼Œè¿å…¬äº¤è½¦å¸æœºéƒ½ä¼šæ‹¿å¸½å­é€ä½ ä¸€ç¨‹ã€‚
æ‰€ä»¥ï¼Œä¸‹æ¬¡å†æƒ³é€›è¡—ä¹°å¸½å­æ—¶ï¼Œå…ˆå»ç…§ç…§é•œå­ï¼Œä¿è¯ä½ ä¹°çš„
ä¸æ˜¯å¸½å­ï¼Œæ˜¯å–œå‰§æ•ˆæœï¼Œè€Œä¸”æˆ‘è¿™å¯ä¸åŒ…å”®åï¼Œå› ä¸ºæˆ‘è‡ªå·±
çš„å¤´å‘å½“ç„¶å¯ä»¥æˆ´å¸½å­ï¼ˆåˆ’æ‰ï¼‰ï¼Œè€Œä½ çš„...ç®—äº†ï¼Œç®—äº†è¿˜æ˜¯ä¹°å§ï¼

============================================================
ğŸ“Š è¯¦ç»†æŠ€æœ¯ä¿¡æ¯:
  ğŸ“ æ¶ˆæ¯ç±»å‹: AIMessageChunk
  ğŸ’° Token ä½¿ç”¨: æœªæä¾›
  ğŸ” å¯¹è±¡å±æ€§æ•°: 52 ä¸ª
============================================================
```

## ğŸ“Š æ€§èƒ½å¯¹æ¯”åˆ†æ

| ç‰¹æ€§       | åŒæ­¥è°ƒç”¨     | æµå¼è°ƒç”¨     |
|----------|----------|----------|
| ç”¨æˆ·ä½“éªŒ     | ç­‰å¾…å®Œæ•´å“åº”   | å®æ—¶é€å­—æ˜¾ç¤º   |
| ä»£ç å¤æ‚åº¦    | ç®€å•       | ä¸­ç­‰       |
| è°ƒè¯•å‹å¥½æ€§    | å“åº”åç»Ÿä¸€æŸ¥çœ‹  | å®æ—¶ç›‘æ§     |
| é€‚ç”¨åœºæ™¯     | çŸ­æ–‡æœ¬ã€å¿«é€ŸåŸå‹ | é•¿æ–‡æœ¬ã€æ­£å¼äº§å“ |
| Token ç»Ÿè®¡ | å®Œæ•´å‡†ç¡®     | éƒ¨åˆ†ç¼ºå¤±     |

## ğŸš€ è¿›é˜¶æ€è€ƒ

### 7.1 å¯æ‰©å±•çš„æ–¹å‘

1. **å¤šæ¨¡å‹æ”¯æŒ**ï¼šé€šè¿‡é…ç½®åˆ‡æ¢ä¸åŒä¾›åº”å•†çš„æ¨¡å‹
2. **å¯¹è¯å†å²ç®¡ç†**ï¼šå®ç°è¿ç»­å¯¹è¯èƒ½åŠ›
3. **è§’è‰²è®¾å®šä¼˜åŒ–**ï¼šæ›´ç²¾ç»†çš„ç³»ç»Ÿæç¤ºè¯è®¾è®¡
4. **é”™è¯¯å¤„ç†æœºåˆ¶**ï¼šç½‘ç»œå¼‚å¸¸ã€API é™æµç­‰æƒ…å†µçš„å¤„ç†
5. **ç¼“å­˜ç­–ç•¥**ï¼šé‡å¤æŸ¥è¯¢çš„æ€§èƒ½ä¼˜åŒ–

### 7.2 æœ€ä½³å®è·µå»ºè®®

```python
# é”™è¯¯å¤„ç†ç¤ºä¾‹
from langchain_core.exceptions import LangChainException

try:
    response = llm.invoke(messages)
    pretty_print_ai_response(response)
except LangChainException as e:
    print(f"âŒ è°ƒç”¨å¤±è´¥: {e}")
except Exception as e:
    print(f"âŒ æœªçŸ¥é”™è¯¯: {e}")
```

## ğŸ“ æ€»ç»“

é€šè¿‡æœ¬æ–‡çš„å­¦ä¹ ï¼Œä½ åº”è¯¥æŒæ¡äº†ï¼š

âœ… **é¡¹ç›®å·¥ç¨‹åŒ–**ï¼šä½¿ç”¨ uv ç®¡ç†ç°ä»£ Python é¡¹ç›®  
âœ… **é…ç½®å®‰å…¨**ï¼šç¯å¢ƒå˜é‡åˆ†ç¦»æ•æ„Ÿä¿¡æ¯  
âœ… **æ¨¡å‹æ¥å…¥**ï¼šOpenAI é£æ ¼çš„ç»Ÿä¸€æ¥å£è°ƒç”¨  
âœ… **äº¤äº’ä½“éªŒ**ï¼šåŒæ­¥ä¸æµå¼ä¸¤ç§è°ƒç”¨æ–¹å¼çš„å·®å¼‚  
âœ… **è°ƒè¯•æŠ€å·§**ï¼šè¯¦ç»†çš„å“åº”ä¿¡æ¯åˆ†æ

è¿™æ˜¯ LangChain å®æˆ˜ç³»åˆ—çš„ç¬¬ä¸€ç¯‡ï¼Œåç»­æˆ‘ä»¬å°†æ·±å…¥æ¢è®¨ï¼š

- å¯¹è¯çŠ¶æ€ç®¡ç†
- å·¥å…·è°ƒç”¨ï¼ˆFunction Callingï¼‰
- é“¾å¼è°ƒç”¨ä¸ Agent è®¾è®¡
- å‘é‡æ•°æ®åº“é›†æˆ
- ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æœ€ä½³å®è·µ

## ğŸ“š å‚è€ƒèµ„æº

- [LangChain å®˜æ–¹æ–‡æ¡£](https://python.langchain.com/)
- [uv åŒ…ç®¡ç†å™¨æ–‡æ¡£](https://docs.astral.sh/uv/)
- [OpenAI API æ–‡æ¡£](https://platform.openai.com/docs/api-reference)

---

*æœ¬æ–‡æ¡£åŸºäºå®é™…é¡¹ç›®ç»éªŒç¼–å†™ï¼Œä»£ç ç»è¿‡éªŒè¯å¯ç›´æ¥è¿è¡Œã€‚å¦‚æœ‰ç–‘é—®ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºäº¤æµè®¨è®ºã€‚*