# LangChainå®æˆ˜å¼€å‘æ•™ç¨‹ï¼ˆå…«ï¼‰ï¼šæ¶ˆæ¯ç³»ç»ŸåŸºç¡€ä¸æ ¸å¿ƒåº”ç”¨

> **æŒæ¡AIå¯¹è¯çš„æ ¸å¿ƒæœºåˆ¶**ï¼šæ·±å…¥ç†è§£LangChainä¸­SystemMessageã€HumanMessageã€AIMessageçš„ä½¿ç”¨æŠ€å·§ä¸æœ€ä½³å®è·µ

## ğŸ¯ æœ¬æ–‡ç›®æ ‡

å…¨é¢è§£æLangChainæ¶ˆæ¯ç³»ç»Ÿçš„æ ¸å¿ƒæ¦‚å¿µå’Œå®é™…åº”ç”¨ï¼ŒæŒæ¡ä¸åŒç±»å‹æ¶ˆæ¯çš„ä½¿ç”¨åœºæ™¯å’Œç»„åˆæŠ€å·§ï¼Œæ„å»ºæ›´åŠ æ™ºèƒ½å’Œè‡ªç„¶çš„AIå¯¹è¯ä½“éªŒã€‚

## ğŸ“š æ ¸å¿ƒçŸ¥è¯†ç‚¹æ¦‚è§ˆ

é€šè¿‡æœ¬æ–‡ä½ å°†æ·±å…¥æŒæ¡ï¼š
- **æ¶ˆæ¯ç±»å‹åŸºç¡€**ï¼šSystemMessageã€HumanMessageã€AIMessageçš„æ ¸å¿ƒä½œç”¨
- **å¯¹è¯æµç¨‹è®¾è®¡**ï¼šæ„å»ºè‡ªç„¶æµç•…çš„å¤šè½®å¯¹è¯ä½“éªŒ
- **è§’è‰²è®¾å®šæŠ€å·§**ï¼šé€šè¿‡SystemMessageç²¾ç¡®æ§åˆ¶AIè¡Œä¸º
- **ä¸Šä¸‹æ–‡ç®¡ç†**ï¼šæœ‰æ•ˆç»´æŠ¤å¯¹è¯å†å²å’ŒçŠ¶æ€
- **æ··åˆæ¶ˆæ¯æ¨¡å¼**ï¼šå¤šç§æ¶ˆæ¯ç±»å‹åè°ƒä½¿ç”¨

## ğŸ”§ æ¶ˆæ¯ç³»ç»Ÿæ ¸å¿ƒæŠ€æœ¯è§£æ

### ä»€ä¹ˆæ˜¯æ¶ˆæ¯ç³»ç»Ÿï¼Ÿ

åœ¨LangChainä¸­ï¼Œæ¶ˆæ¯ç³»ç»Ÿæ˜¯AIå¯¹è¯çš„æ ¸å¿ƒåŸºç¡€è®¾æ–½ã€‚æ¯ç§æ¶ˆæ¯ç±»å‹éƒ½æœ‰ç‰¹å®šçš„è¯­ä¹‰å«ä¹‰å’Œä½¿ç”¨åœºæ™¯ï¼š

- **SystemMessage**ï¼šè®¾å®šAIçš„è¡Œä¸ºå‡†åˆ™å’Œè§’è‰²å®šä½
- **HumanMessage**ï¼šç”¨æˆ·è¾“å…¥å’ŒæŸ¥è¯¢å†…å®¹
- **AIMessage**ï¼šAIçš„å†å²å›å¤å’Œå½“å‰å“åº”
- **ToolMessage**ï¼šå·¥å…·è°ƒç”¨çš„ç»“æœåé¦ˆ

### æ ¸å¿ƒä»·å€¼

1. **ç²¾ç¡®æ§åˆ¶**ï¼šé€šè¿‡ä¸åŒç±»å‹æ¶ˆæ¯å®ç°ç²¾ç»†çš„è¡Œä¸ºæ§åˆ¶
2. **ä¸Šä¸‹æ–‡ä¿æŒ**ï¼šç»´æŠ¤å¯¹è¯è¿è´¯æ€§å’Œå†å²è®°å¿†
3. **è§’è‰²æ‰®æ¼”**ï¼šæ”¯æŒå¤æ‚çš„AIè§’è‰²è®¾å®šå’Œåˆ‡æ¢
4. **çŠ¶æ€ç®¡ç†**ï¼šæœ‰æ•ˆç®¡ç†å¯¹è¯çŠ¶æ€å’Œç”¨æˆ·æ„å›¾

## ğŸš€ æ¶ˆæ¯ç±»å‹è¯¦è§£ä¸å®æˆ˜

### 1. SystemMessageï¼šAIè¡Œä¸ºæ§åˆ¶å™¨

SystemMessageç”¨äºè®¾å®šAIçš„ç³»ç»Ÿè¡Œä¸ºå’Œè§’è‰²å®šä½ï¼Œæ˜¯æœ€å¼ºå¤§çš„æ§åˆ¶æ‰‹æ®µã€‚

```python
from langchain_core.messages import SystemMessage, HumanMessage
from langchain.chat_models import init_chat_model

def system_message_fundamentals():
    """SystemMessageåŸºç¡€ä½¿ç”¨"""
    
    model = init_chat_model(model="Qwen/Qwen3-8B")
    
    # ç¤ºä¾‹1ï¼šåŸºç¡€è§’è‰²è®¾å®š
    print("=== åŸºç¡€è§’è‰²è®¾å®š ===")
    system_msg = SystemMessage("ä½ æ˜¯ä¸€ä½èµ„æ·±çš„Pythonå¼€å‘ä¸“å®¶ï¼Œæ“…é•¿ä»£ç å®¡æŸ¥å’Œæœ€ä½³å®è·µæŒ‡å¯¼")
    human_code = HumanMessage("""
    è¯·å¸®æˆ‘å®¡æŸ¥è¿™æ®µä»£ç ï¼š
    ```python
    def calculate_sum(numbers):
        result = 0
        for num in numbers:
            result += num
        return result
    ```
    """)
    
    response = model.invoke([system_msg, human_code])
    print("AIå›å¤ï¼š", response.content)
    
    # ç¤ºä¾‹2ï¼šè¡Œä¸ºçº¦æŸ
    print("\n=== è¡Œä¸ºçº¦æŸç¤ºä¾‹ ===")
    constraint_system = SystemMessage("""
    ä½ æ˜¯ä¸€ä¸ªä¸¥æ ¼çš„è¯­è¨€è€å¸ˆï¼Œè¯·ç”¨ä»¥ä¸‹è§„åˆ™å›å¤ï¼š
    1. å¿…é¡»ä½¿ç”¨æ­£å¼ã€ç¤¼è²Œçš„è¯­è¨€
    2. å›ç­”è¦ç®€æ´æ˜äº†ï¼Œä¸è¶…è¿‡100å­—
    3. å¦‚æœä¸çŸ¥é“ç­”æ¡ˆï¼Œç›´æ¥è¯´"æˆ‘ä¸çŸ¥é“"
    """)
    
    question = HumanMessage("ä¸–ç•Œä¸Šæœ€é«˜çš„å±±æ˜¯ä»€ä¹ˆï¼Ÿ")
    response = model.invoke([constraint_system, question])
    print("çº¦æŸæ€§å›å¤ï¼š", response.content)
    
    # ç¤ºä¾‹3ï¼šå¤šè§’è‰²åˆ‡æ¢
    print("\n=== å¤šè§’è‰²åˆ‡æ¢ ===")
    poet_system = SystemMessage("ä½ ç°åœ¨æ˜¯ä¸€ä½å¤ä»£è¯—äººï¼Œè¯´è¯è¦æœ‰å¤é£éŸµå‘³")
    topic = HumanMessage("è¯·å†™ä¸€é¦–å…³äºæ˜¥å¤©çš„è¯—")
    
    response = model.invoke([poet_system, topic])
    print("è¯—äººé£æ ¼å›å¤ï¼š", response.content)
```

### 2. HumanMessageï¼šç”¨æˆ·äº¤äº’å…¥å£

HumanMessageä»£è¡¨ç”¨æˆ·çš„æ‰€æœ‰è¾“å…¥å†…å®¹ï¼Œæ˜¯AIå¤„ç†çš„ä¸»è¦å¯¹è±¡ã€‚

```python
def human_message_patterns():
    """HumanMessageä½¿ç”¨æ¨¡å¼"""
    
    model = init_chat_model(model="Qwen/Qwen3-8B")
    
    # ç¤ºä¾‹1ï¼šåŸºç¡€é—®ç­”
    print("=== åŸºç¡€é—®ç­”æ¨¡å¼ ===")
    basic_question = HumanMessage("Pythonä¸­åˆ—è¡¨å’Œå…ƒç»„æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ")
    response = model.invoke([basic_question])
    print("åŸºç¡€å›ç­”ï¼š", response.content)
    
    # ç¤ºä¾‹2ï¼šå¸¦ä¸Šä¸‹æ–‡çš„æé—®
    print("\n=== å¸¦ä¸Šä¸‹æ–‡æé—® ===")
    context = SystemMessage("ä½ æ­£åœ¨å¸®åŠ©ç”¨æˆ·å­¦ä¹ æ•°æ®ç»“æ„")
    technical_question = HumanMessage("èƒ½è¯¦ç»†è§£é‡Šä¸€ä¸‹äºŒå‰æ ‘çš„éå†æ–¹å¼å—ï¼Ÿ")
    
    response = model.invoke([context, technical_question])
    print("æŠ€æœ¯è¯¦ç»†å›ç­”ï¼š", response.content)
    
    # ç¤ºä¾‹3ï¼šå¤šè½®å¯¹è¯å»¶ç»­
    print("\n=== å¤šè½®å¯¹è¯å»¶ç»­ ===")
    conversation = [
        HumanMessage("æˆ‘æƒ³å­¦ä¹ æœºå™¨å­¦ä¹ "),
        AIMessage("å¾ˆå¥½çš„é€‰æ‹©ï¼æœºå™¨å­¦ä¹ æ˜¯äººå·¥æ™ºèƒ½çš„é‡è¦åˆ†æ”¯ã€‚ä½ å¯¹å“ªä¸ªæ–¹é¢ç‰¹åˆ«æ„Ÿå…´è¶£ï¼Ÿ"),
        HumanMessage("æˆ‘æƒ³å…ˆäº†è§£ç›‘ç£å­¦ä¹ å’Œæ— ç›‘ç£å­¦ä¹ çš„åŒºåˆ«")
    ]
    
    response = model.invoke(conversation)
    print("å¯¹è¯å»¶ç»­å›ç­”ï¼š", response.content)
```

å¯¹äºHumanMessageï¼Œé™¤äº†ä¸Šé¢çš„ä½¿ç”¨æ–¹å¼ä¹‹å¤–ï¼Œè¿˜æ”¯æŒæ·»åŠ å…ƒæ•°æ®ï¼Œå¦‚

```python
human_msg = HumanMessage(
    content="Hello!",
    name="alice",  # Optional: ç”¨äºè¡¨ç¤ºä¸åŒçš„ç”¨æˆ·
    id="msg_123",  # Optional: ç”¨äºé“¾è·¯æœ€ç»ˆçš„å”¯ä¸€ID
)
```


### 3. AIMessageï¼šå†å²ä¸å½“å‰å“åº”

AIMessageä¸ä»…åŒ…å«å½“å‰å›å¤ï¼Œè¿˜å¯ç”¨äºæ„å»ºå¯¹è¯å†å²ï¼Œç»´æŒä¸Šä¸‹æ–‡è¿è´¯æ€§ã€‚æ³¨æ„`AIMessage`å¸¸è§äºå¤§æ¨¡å‹çš„è¿”å›ã€ç”¨äºæ„é€ å¤šè½®å¯¹è¯ï¼›ä¹Ÿå¯ä»¥ç”¨äºå°‘æ ·æœ¬å­¦ä¹ /æ€ç»´é“¾ï¼Œç”¨äºæŒ‡å¯¼å¤§æ¨¡å‹çš„æ€è€ƒæ–¹å¼

```python
def ai_message_applications():
    """AIMessageåº”ç”¨å®ä¾‹"""
    
    model = init_chat_model(model="Qwen/Qwen3-8B")
    
    # ç¤ºä¾‹1ï¼šæ¨¡æ‹Ÿå†å²å¯¹è¯
    print("=== æ¨¡æ‹Ÿå†å²å¯¹è¯ ===")
    conversation_history = [
        SystemMessage("ä½ æ˜¯ä¸€ä¸ªæ—…æ¸¸å’¨è¯¢åŠ©æ‰‹"),
        HumanMessage("æˆ‘æƒ³å»åŒ—äº¬æ—…æ¸¸ï¼Œæœ‰ä»€ä¹ˆæ¨èå—ï¼Ÿ"),
        AIMessage("åŒ—äº¬æœ‰å¾ˆå¤šå€¼å¾—æ¸¸è§ˆçš„åœ°æ–¹ï¼æ¨èæ‚¨å‚è§‚æ•…å®«ã€å¤©å›ã€é¢å’Œå›­ç­‰å†å²æ–‡åŒ–æ™¯ç‚¹ï¼Œè¿˜æœ‰798è‰ºæœ¯åŒºç­‰ç°ä»£æ–‡åŒ–åœºæ‰€ã€‚"),
        HumanMessage("è¿™äº›åœ°æ–¹çš„é—¨ç¥¨ä»·æ ¼æ€ä¹ˆæ ·ï¼Ÿ")
    ]
    
    response = model.invoke(conversation_history)
    print("åŸºäºå†å²çš„å›ç­”ï¼š", response.content)
    
    # ç¤ºä¾‹2ï¼šå¸¦æœ‰æ€è€ƒè¿‡ç¨‹çš„AIå›å¤
    print("\n=== å¸¦æ€è€ƒè¿‡ç¨‹çš„å›å¤ ===")
    logic_conversation = [
        SystemMessage("ä½ æ˜¯ä¸€ä¸ªé€»è¾‘æ¨ç†ä¸“å®¶ï¼Œè¯·å±•ç¤ºä½ çš„æ€è€ƒè¿‡ç¨‹"),
        HumanMessage("å¦‚æœæ‰€æœ‰çš„çŒ«éƒ½æ˜¯åŠ¨ç‰©ï¼Œæ±¤å§†æ˜¯çŒ«ï¼Œé‚£ä¹ˆæ±¤å§†æ˜¯ä»€ä¹ˆï¼Ÿ"),
        AIMessage("""
        è®©æˆ‘æ¥åˆ†æè¿™ä¸ªé€»è¾‘æ¨ç†é¢˜ï¼š
        
        å·²çŸ¥æ¡ä»¶ï¼š
        1. æ‰€æœ‰çš„çŒ«éƒ½æ˜¯åŠ¨ç‰©ï¼ˆå‰æï¼‰
        2. æ±¤å§†æ˜¯çŒ«ï¼ˆäº‹å®ï¼‰
        
        æ¨ç†è¿‡ç¨‹ï¼š
        æ ¹æ®ä¸‰æ®µè®ºæ¨ç†ï¼š
        - å¤§å‰æï¼šæ‰€æœ‰çŒ«éƒ½æ˜¯åŠ¨ç‰©
        - å°å‰æï¼šæ±¤å§†æ˜¯çŒ«
        - ç»“è®ºï¼šæ±¤å§†æ˜¯åŠ¨ç‰©
        
        å› æ­¤ï¼Œæ±¤å§†æ˜¯åŠ¨ç‰©ã€‚
        """),
        HumanMessage("é‚£å¦‚æœæˆ‘è¿˜å‘Šè¯‰ä½ æ±¤å§†ä¼šé£å‘¢ï¼Ÿ")
    ]
    
    response = model.invoke(logic_conversation)
    print("å¤æ‚é€»è¾‘å›ç­”ï¼š", response.content)
```

## ğŸ¯ å®æˆ˜åº”ç”¨åœºæ™¯

### åœºæ™¯1ï¼šè§’è‰²æ‰®æ¼”æ¸¸æˆ

```python
def rpg_game_scenario():
    """è§’è‰²æ‰®æ¼”æ¸¸æˆåœºæ™¯"""
    
    model = init_chat_model(model="Qwen/Qwen3-8B")
    
    rpg_conversation = [
        SystemMessage("""
        æ¸¸æˆè®¾å®šï¼šä½ æ˜¯ä¸€ä½ä¸­ä¸–çºªçš„éª‘å£«å¯¼å¸ˆ
        è§„åˆ™ï¼š
        1. ä½¿ç”¨ä¸­ä¸–çºªé£æ ¼çš„è¯­è¨€
        2. å›ç­”è¦ä½“ç°éª‘å£«ç²¾ç¥
        3. å¯ä»¥é€‚å½“åŠ å…¥å†å²å…¸æ•…
        """),
        HumanMessage("å°Šæ•¬çš„å¯¼å¸ˆï¼Œæˆ‘æƒ³å­¦ä¹ å‰‘æœ¯"),
        AIMessage("å¹´è½»çš„å‹‡å£«ï¼Œå‰‘æœ¯ä¹ƒéª‘å£«ä¹‹é­‚ï¼è®©æˆ‘å…ˆè€ƒéªŒä½ çš„å†³å¿ƒ..."),
        HumanMessage("æˆ‘æ„¿æ„æ¥å—ä»»ä½•è€ƒéªŒï¼"),
    ]
    
    response = model.invoke(rpg_conversation)
    print("RPGæ¸¸æˆå¯¹è¯ï¼š", response.content)
```

### åœºæ™¯2ï¼šæŠ€æœ¯æ”¯æŒå¯¹è¯

```python
def technical_support_scenario():
    """æŠ€æœ¯æ”¯æŒå¯¹è¯åœºæ™¯"""
    
    model = init_chat_model(model="Qwen/Qwen3-8B")
    
    support_conversation = [
        SystemMessage("ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„PythonæŠ€æœ¯æ”¯æŒå·¥ç¨‹å¸ˆï¼Œå–„äºè§£å†³å„ç§ç¼–ç¨‹é—®é¢˜"),
        HumanMessage("æˆ‘çš„Pythonç¨‹åºè¿è¡Œæ—¶æŠ¥é”™ï¼šImportError: No module named 'requests'"),
        AIMessage("è¿™ä¸ªé”™è¯¯è¡¨æ˜æ‚¨çš„ç¯å¢ƒä¸­ç¼ºå°‘requestsåº“ã€‚æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è§£å†³ï¼š\n1. è¿è¡Œå‘½ä»¤ï¼špip install requests\n2. å¦‚æœä½¿ç”¨condaï¼šconda install requests"),
        HumanMessage("å®‰è£…åè¿˜æ˜¯æŠ¥åŒæ ·çš„é”™è¯¯æ€ä¹ˆåŠï¼Ÿ"),
    ]
    
    response = model.invoke(support_conversation)
    print("æŠ€æœ¯æ”¯æŒå¯¹è¯ï¼š", response.content)
```

### åœºæ™¯3ï¼šåˆ›æ„å†™ä½œåŠ©æ‰‹

```python
def creative_writing_scenario():
    """åˆ›æ„å†™ä½œåŠ©æ‰‹åœºæ™¯"""
    
    model = init_chat_model(model="Qwen/Qwen3-8B")
    
    writing_conversation = [
        SystemMessage("ä½ æ˜¯ä¸€ä½ç»éªŒä¸°å¯Œçš„ç§‘å¹»å°è¯´ä½œå®¶ï¼Œå–„äºæ„å»ºå¤æ‚çš„ä¸–ç•Œè§‚"),
        HumanMessage("æˆ‘æƒ³å†™ä¸€ä¸ªå…³äºæ—¶é—´æ—…è¡Œçš„æ•…äº‹ï¼Œèƒ½ç»™æˆ‘ä¸€äº›çµæ„Ÿå—ï¼Ÿ"),
        AIMessage("""
        æ—¶é—´æ—…è¡Œé¢˜æçš„ç»å…¸å…ƒç´ ï¼š
        
        ğŸŒŸ æ ¸å¿ƒå†²çªï¼š
        - å› æœæ‚–è®ºï¼šæ”¹å˜è¿‡å»å½±å“ç°åœ¨
        - æ—¶é—´çº¿åˆ†è£‚ï¼šåˆ›é€ å¹³è¡Œå®‡å®™
        - è®°å¿†é”™ä½ï¼šç©¿è¶Šè€…ä¿ç•™è®°å¿†
        
        ğŸ­ è§’è‰²è®¾å®šï¼š
        - æ—¶é—´å®ˆæŠ¤è€…ï¼šç»´æŠ¤æ—¶é—´ç§©åº
        - å†å²è§‚å¯Ÿè€…ï¼šåªèƒ½è§‚çœ‹ä¸èƒ½å¹²é¢„
        - æ—¶é—´ç½ªçŠ¯ï¼šæ¶æ„ç¯¡æ”¹å†å²
        
        ğŸŒŒ ä¸–ç•Œè§‚æ„å»ºï¼š
        - æ—¶é—´ç®¡ç†å±€ï¼šç›‘ç®¡æ‰€æœ‰æ—¶é—´æ´»åŠ¨
        - æ—¶é—´é£æš´ï¼šæ—¶ç©ºä¸ç¨³å®šç°è±¡
        - è®°å¿†é”šç‚¹ï¼šå›ºå®šå†å²å…³é”®èŠ‚ç‚¹
        """),
        HumanMessage("å¬èµ·æ¥å¾ˆæ£’ï¼é‚£ä¸»è§’åº”è¯¥æ˜¯ä»€ä¹ˆèº«ä»½æ¯”è¾ƒå¥½ï¼Ÿ")
    ]
    
    response = model.invoke(writing_conversation)
    print("åˆ›æ„å†™ä½œå¯¹è¯ï¼š", response.content)
```

## âš¡ é«˜çº§åº”ç”¨æ¨¡å¼

### 1. æ€ç»´é“¾æ¨ç†æ¨¡å¼ (Chain-of-Thought)

**ä»€ä¹ˆæ˜¯æ€ç»´é“¾ (Chain-of-Thought)**ï¼š

æ€ç»´é“¾æ˜¯ä¸€ç§è®©AIæ¨¡å‹å±•ç¤ºå…¶æ¨ç†è¿‡ç¨‹çš„æŠ€æœ¯ï¼Œé€šè¿‡é€æ­¥åˆ†è§£é—®é¢˜è§£å†³æ­¥éª¤ï¼Œä½¿AIèƒ½å¤Ÿåƒäººç±»ä¸€æ ·"æ€è€ƒ"å¹¶å±•ç¤ºæ¨ç†è·¯å¾„ã€‚è¿™ç§æ¨¡å¼ç‰¹åˆ«é€‚ç”¨äºå¤æ‚é€»è¾‘æ¨ç†ã€æ•°å­¦è®¡ç®—ã€é—®é¢˜åˆ†æç­‰éœ€è¦å¤šæ­¥éª¤è§£å†³çš„ä»»åŠ¡ã€‚

**æ ¸å¿ƒåŸç†**ï¼š
- å°†å¤æ‚é—®é¢˜åˆ†è§£ä¸ºå¤šä¸ªä¸­é—´æ­¥éª¤
- æ¯ä¸ªæ­¥éª¤éƒ½åŒ…å«æ˜ç¡®çš„æ¨ç†é€»è¾‘
- æœ€ç»ˆå¾—å‡ºç»“è®ºå‰å±•ç¤ºå®Œæ•´æ€è€ƒè¿‡ç¨‹
- æé«˜AIè¾“å‡ºçš„å¯è§£é‡Šæ€§å’Œå‡†ç¡®æ€§

**åœ¨æ¶ˆæ¯ç³»ç»Ÿä¸­çš„åº”ç”¨**ï¼š
é€šè¿‡SystemMessageè®¾å®šAIéœ€è¦å±•ç¤ºæ€è€ƒè¿‡ç¨‹ï¼Œä½¿ç”¨AIMessageè®°å½•æ¨ç†æ­¥éª¤ï¼Œå½¢æˆå®Œæ•´çš„æ€ç»´é“¾è·¯ã€‚

```python
def chain_of_thought_pattern():
    """æ€ç»´é“¾æ¨ç†æ¨¡å¼"""
    
    model = init_chat_model(model="Qwen/Qwen3-8B")
    
    cot_conversation = [
        SystemMessage("ä½ æ˜¯ä¸€ä¸ªé€»è¾‘æ¨ç†ä¸“å®¶ï¼Œè¯·åˆ†æ­¥éª¤æ€è€ƒé—®é¢˜"),
        HumanMessage("å¦‚æœA>Bï¼ŒB>Cï¼ŒC>Dï¼Œé‚£ä¹ˆAå’ŒDçš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ"),
        AIMessage("""
        è®©æˆ‘é€æ­¥åˆ†æè¿™ä¸ªé€»è¾‘å…³ç³»ï¼š
        
        ç¬¬ä¸€æ­¥ï¼šåˆ†æå·²çŸ¥æ¡ä»¶
        - A > B ï¼ˆAå¤§äºBï¼‰
        - B > C ï¼ˆBå¤§äºCï¼‰
        - C > D ï¼ˆCå¤§äºDï¼‰
        
        ç¬¬äºŒæ­¥ï¼šå»ºç«‹ä¼ é€’å…³ç³»
        ç”±äºå¤§äºå…³ç³»å…·æœ‰ä¼ é€’æ€§ï¼š
        - ä»A>Bå’ŒB>Cå¯ä»¥æ¨å‡ºA>C
        - ä»A>Cå’ŒC>Då¯ä»¥æ¨å‡ºA>D
        
        ç¬¬ä¸‰æ­¥ï¼šå¾—å‡ºç»“è®º
        å› æ­¤ï¼ŒA > D
        
        ç­”æ¡ˆï¼šAå¤§äºD
        """),
        HumanMessage("å¾ˆå¥½ï¼é‚£å¦‚æœæ˜¯Aâ‰¥Bï¼ŒBâ‰¥Cï¼ŒCâ‰¥Då‘¢ï¼Ÿ")
    ]
    
    response = model.invoke(cot_conversation)
    print("æ€ç»´é“¾æ¨ç†ï¼š", response.content)
```

è°ƒç”¨å¤§æ¨¡å‹æ‰§è¡Œä¹‹åï¼Œä¸‹é¢æ˜¯ä¸€æ¬¡è¿”å›ï¼ˆä¸åŒçš„å¤§æ¨¡å‹è¡¨ç°å¹¶ä¸ä¸€æ ·ï¼Œä¸èƒ½ä¿è¯æ¯æ¬¡éƒ½æ˜¯ç›¸åŒçš„è¾“å‡ºï¼‰

```markdown
æ¨¡å¼1ï¼šæ€ç»´é“¾æ¨ç†
============================================================
ğŸ¤– AI æ™ºèƒ½å›å¤
============================================================
ğŸ’¬ å›å¤å†…å®¹:
æ˜¯çš„ï¼è®©æˆ‘ä»¬ä¸€æ­¥æ­¥åˆ†æè¿™ä¸ªé€»è¾‘å…³ç³»ï¼š
### æ­¥éª¤1ï¼šåˆ†æå·²çŸ¥æ¡ä»¶
- ç»™å®šæ¡ä»¶ï¼šA â‰¥ Bï¼ˆAå¤§äºæˆ–ç­‰äºBï¼‰ï¼ŒB â‰¥ Cï¼ˆBå¤§äºæˆ–ç­‰äºCï¼‰ï¼ŒC â‰¥ Dï¼ˆCå¤§äºæˆ–ç­‰äºDï¼‰ã€‚
### æ­¥éª¤2ï¼šåº”ç”¨ä¼ é€’æ€§
- ä¸ç­‰å¼â€œå¤§äºæˆ–ç­‰äºâ€ï¼ˆâ‰¥ï¼‰å…·æœ‰ä¼ é€’æ€§ï¼šå¦‚æœP â‰¥ Q å’Œ Q â‰¥ Rï¼Œåˆ™P â‰¥ Rã€‚
- ä»A â‰¥ B å’Œ B â‰¥ Cï¼Œå¯ä»¥æ¨å‡ºA â‰¥ Cã€‚
- ç„¶åï¼Œä»A â‰¥ C å’Œ C â‰¥ Dï¼Œå¯ä»¥æ¨å‡ºA â‰¥ Dã€‚
### æ­¥éª¤3ï¼šè€ƒè™‘è¾¹ç•Œæƒ…å†µ
- å³ä½¿æŸäº›ç­‰å·æˆç«‹ï¼ˆä¾‹å¦‚A = B æˆ– C = Dï¼‰ï¼Œå…³ç³»ä¾ç„¶ä¿æŒA â‰¥ Dã€‚
  - å¦‚æœæ‰€æœ‰ç­‰å·éƒ½æˆç«‹ï¼ˆA = B = C = Dï¼‰ï¼Œåˆ™A = Dã€‚
  - å¦‚æœæŸäº›éƒ¨åˆ†ä¸¥æ ¼å¤§äºï¼ˆä¾‹å¦‚A > B ä¸” C > Dï¼‰ï¼Œåˆ™A > Dã€‚
- åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼ŒAæ€»æ˜¯å¤§äºæˆ–ç­‰äºDã€‚
### ç»“è®º
å› æ­¤ï¼ŒAå’ŒDçš„å…³ç³»æ˜¯ï¼šA â‰¥ Dã€‚
å¦‚æœéœ€è¦æ›´å¤šç»†èŠ‚æˆ–ä¾‹å­ï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ï¼
```

### 2. è‡ªæˆ‘åæ€æœºåˆ¶

**ä»€ä¹ˆæ˜¯è‡ªæˆ‘åæ€æœºåˆ¶**ï¼š

è‡ªæˆ‘åæ€æœºåˆ¶æ˜¯ä¸€ç§è®©AIæ¨¡å‹å¯¹è‡ªå·±çš„å›ç­”è¿›è¡Œè¯„ä¼°ã€åˆ†æå’Œæ”¹è¿›çš„æŠ€æœ¯ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼ŒAIä¸ä»…èƒ½æä¾›åˆå§‹ç­”æ¡ˆï¼Œè¿˜èƒ½ä¸»åŠ¨åˆ†æè‡ªå·±å›ç­”çš„è´¨é‡ã€å‡†ç¡®æ€§å’Œå®Œæ•´æ€§ï¼Œå¹¶åŸºäºåæ€ç»“æœè¿›è¡Œæ”¹è¿›æˆ–ä¿®æ­£ã€‚

**æ ¸å¿ƒåŸç†**ï¼š
- **è‡ªæˆ‘è¯„ä¼°**ï¼šAIå¯¹è‡ªå·±ç”Ÿæˆçš„å†…å®¹è¿›è¡Œè´¨é‡è¯„ä¼°
- **åˆ†æä¸è¶³**ï¼šè¯†åˆ«å›ç­”ä¸­çš„ç¼ºé™·ã€é—æ¼æˆ–é”™è¯¯
- **ä¸»åŠ¨æ”¹è¿›**ï¼šåŸºäºè¯„ä¼°ç»“æœæå‡ºæ”¹è¿›å»ºè®®æˆ–ä¿®æ­£
- **æŒç»­ä¼˜åŒ–**ï¼šå½¢æˆåæ€-æ”¹è¿›çš„å¾ªç¯æœºåˆ¶

**åœ¨æ¶ˆæ¯ç³»ç»Ÿä¸­çš„åº”ç”¨**ï¼š
é€šè¿‡SystemMessageè®¾å®šAIéœ€è¦è¿›è¡Œè‡ªæˆ‘åæ€ï¼Œä½¿ç”¨AIMessageæ‰¿è½½åæ€è¿‡ç¨‹ï¼Œé€šè¿‡å¯¹è¯å½¢å¼å®ç°è‡ªæˆ‘çº æ­£å’Œæ”¹è¿›ã€‚

```python
def self_reflection_pattern():
    """è‡ªæˆ‘åæ€æ¨¡å¼"""
    
    model = init_chat_model(model="Qwen/Qwen3-8B")
    
    reflection_conversation = [
        SystemMessage("ä½ æ˜¯ä¸€ä¸ªå–„äºè‡ªæˆ‘åæ€çš„AIåŠ©æ‰‹ï¼Œè¯·åœ¨å›ç­”åè¯„ä¼°è‡ªå·±çš„å›ç­”è´¨é‡"),
        HumanMessage("è¯·è§£é‡Šä»€ä¹ˆæ˜¯é€’å½’å‡½æ•°"),
        AIMessage("""
        é€’å½’å‡½æ•°æ˜¯åœ¨å‡½æ•°å®šä¹‰ä¸­è°ƒç”¨å‡½æ•°è‡ªèº«çš„ç¼–ç¨‹æŠ€æœ¯ã€‚
        
        ç‰¹ç‚¹ï¼š
        1. å¿…é¡»æœ‰åŸºç¡€æƒ…å†µï¼ˆç»ˆæ­¢æ¡ä»¶ï¼‰
        2. å¿…é¡»æœ‰é€’å½’æƒ…å†µï¼ˆè°ƒç”¨è‡ªèº«ï¼‰
        3. æ¯æ¬¡é€’å½’éƒ½åº”è¯¥å‘åŸºç¡€æƒ…å†µé è¿‘
        
        ç¤ºä¾‹ï¼š
        
        def factorial(n):
            if n <= 1:  # åŸºç¡€æƒ…å†µ
                return 1
            else:       # é€’å½’æƒ…å†µ
                return n * factorial(n-1)

        
        è‡ªæˆ‘è¯„ä¼°ï¼š
        âœ“ å‡†ç¡®è§£é‡Šäº†é€’å½’çš„æ¦‚å¿µ
        âœ“ æä¾›äº†å…³é”®ç‰¹ç‚¹
        âœ“ ç»™å‡ºäº†å…·ä½“ä»£ç ç¤ºä¾‹
        âš  å¯ä»¥è¡¥å……æ›´å¤šå®é™…åº”ç”¨åœºæ™¯
        """),
        HumanMessage("ä½ çš„è§£é‡Šè¿˜å¯ä»¥æ›´è¯¦ç»†ä¸€äº›")
    ]
    
    response = model.invoke(reflection_conversation)
    print("è‡ªæˆ‘åæ€å¯¹è¯ï¼š", response.content)
```

ä¸Šè¿°ä»£ç ç¤ºä¾‹ä½“ç°äº†è‡ªæˆ‘åæ€æœºåˆ¶çš„æ ¸å¿ƒè¦ç´ ï¼š
- **SystemMessage** è®¾å®šäº†"å–„äºè‡ªæˆ‘åæ€çš„AIåŠ©æ‰‹"çš„è§’è‰²
- **é¦–æ¬¡AIå›ç­”** ä¸ä»…è§£é‡Šäº†é€’å½’å‡½æ•°ï¼Œè¿˜åŒ…å«äº†è‡ªæˆ‘è¯„ä¼°éƒ¨åˆ†
- **è‡ªæˆ‘è¯„ä¼°** æ˜ç¡®æ ‡æ³¨äº†å›ç­”çš„ä¼˜ç‚¹ï¼ˆâœ“ï¼‰å’Œä¸è¶³ï¼ˆâš ï¼‰
- **ç”¨æˆ·åé¦ˆ** "ä½ çš„è§£é‡Šè¿˜å¯ä»¥æ›´è¯¦ç»†ä¸€äº›"è§¦å‘è¿›ä¸€æ­¥æ”¹è¿›
- **åæ€å¾ªç¯** AIå¯ä»¥æ ¹æ®åæ€ç»“æœå’Œç”¨æˆ·åé¦ˆç»§ç»­ä¼˜åŒ–å›ç­”

æˆ‘æˆ‘ä»¬æ¥å®é™…çœ‹ä¸€ä¸‹å®ƒçš„è¾“å‡º

```markdown
æ¨¡å¼2ï¼šè‡ªæˆ‘åæ€æœºåˆ¶
============================================================
ğŸ¤– AI æ™ºèƒ½å›å¤
============================================================
ğŸ’¬ å›å¤å†…å®¹:
å½“ç„¶å¯ä»¥ã€‚è®©æˆ‘ä»¬æ›´æ·±å…¥åœ°æ¢è®¨é€’å½’å‡½æ•°çš„æ¦‚å¿µï¼ŒåŒ…æ‹¬å®ƒçš„åŸç†ã€å¦‚ä½•å®ç°ï¼Œä»¥åŠä¸ºä»€ä¹ˆä½¿ç”¨é€’å½’ã€‚
### é€’å½’å‡½æ•°çš„åŸç†
é€’å½’å‡½æ•°æ˜¯ä¸€ç§è§£å†³é—®é¢˜çš„æ–¹æ³•ï¼Œå®ƒå°†ä¸€ä¸ªé—®é¢˜åˆ†è§£ä¸ºæ›´å°çš„ã€ç±»ä¼¼çš„é—®é¢˜æ¥æ±‚è§£ã€‚é€’å½’å‡½æ•°é€šè¿‡ä»¥ä¸‹æ­¥éª¤å·¥ä½œï¼š
1. **åŸºç¡€æƒ…å†µï¼ˆBase Caseï¼‰**ï¼šé€’å½’å‡½æ•°å¿…é¡»æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªåŸºç¡€æƒ…å†µï¼Œè¿™äº›æƒ…å†µä¸éœ€è¦è¿›ä¸€æ­¥é€’å½’ï¼Œå¯ä»¥ç›´æ¥è¿”å›ç»“æœã€‚è¿™æ˜¯é€’å½’çš„ç»ˆæ­¢æ¡ä»¶ï¼Œç¡®ä¿é€’å½’ä¸ä¼šæ— é™è¿›è¡Œã€‚
2. **é€’å½’æ­¥éª¤ï¼ˆRecursive Stepï¼‰**ï¼šåœ¨åŸºç¡€æƒ…å†µä¹‹å¤–ï¼Œå‡½æ•°ä¼šè°ƒç”¨è‡ªèº«æ¥å¤„ç†æ›´å°çš„é—®é¢˜ã€‚æ¯æ¬¡é€’å½’è°ƒç”¨éƒ½ä¼šå‘åŸºç¡€æƒ…å†µé è¿‘ã€‚
3. **é€’å½’å †æ ˆ**ï¼šæ¯æ¬¡é€’å½’è°ƒç”¨éƒ½ä¼šåœ¨ç¨‹åºå †æ ˆä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„å¸§ï¼Œå…¶ä¸­åŒ…å«å±€éƒ¨å˜é‡å’Œè¿”å›åœ°å€ã€‚é€’å½’å‡½æ•°ä¼šä¸€ç›´è°ƒç”¨è‡ªèº«ï¼Œç›´åˆ°è¾¾åˆ°åŸºç¡€æƒ…å†µï¼Œç„¶åå¼€å§‹é€å±‚è¿”å›ç»“æœã€‚
### å¦‚ä½•å®ç°é€’å½’å‡½æ•°
å®ç°é€’å½’å‡½æ•°é€šå¸¸éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š
- ç¡®å®šåŸºç¡€æƒ…å†µï¼Œç¡®ä¿é€’å½’èƒ½å¤Ÿåœæ­¢ã€‚
- è®¾è®¡é€’å½’æ­¥éª¤ï¼Œç¡®ä¿æ¯æ¬¡é€’å½’éƒ½å‘åŸºç¡€æƒ…å†µé è¿‘ã€‚
- åœ¨å‡½æ•°ä½“å†…è°ƒç”¨è‡ªèº«ã€‚
### ä¸ºä»€ä¹ˆä½¿ç”¨é€’å½’
é€’å½’åœ¨æŸäº›æƒ…å†µä¸‹æ¯”è¿­ä»£æ›´è‡ªç„¶ã€æ›´ç®€æ´ï¼Œå°¤å…¶æ˜¯å½“é—®é¢˜å…·æœ‰é€’å½’æ€§è´¨æ—¶ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›ä½¿ç”¨é€’å½’çš„ç†ç”±ï¼š
- **ç®€æ´æ€§**ï¼šé€’å½’å¯ä»¥ä½¿å¾—ä»£ç æ›´åŠ ç®€æ´ï¼Œç‰¹åˆ«æ˜¯å¯¹äºä¸€äº›å…·æœ‰è‡ªç„¶é€’å½’ç»“æ„çš„é—®é¢˜ï¼Œå¦‚é˜¶ä¹˜ã€å½’å¹¶æ’åºã€å¿«é€Ÿæ’åºç­‰ã€‚
- **ç›´è§‚æ€§**ï¼šé€’å½’ç®—æ³•é€šå¸¸æ›´ç¬¦åˆäººç±»è§£å†³é—®é¢˜çš„ç›´è§‰ï¼Œå› ä¸ºå®ƒä»¬é€šå¸¸æ¨¡ä»¿é—®é¢˜æœ¬èº«çš„åˆ†è§£æ–¹å¼ã€‚
- **æ˜“äºç†è§£**ï¼šé€’å½’ç®—æ³•å¯ä»¥é€šè¿‡å›¾å½¢åŒ–çš„é€’å½’æ ‘æ¥å¯è§†åŒ–ï¼Œè¿™æœ‰åŠ©äºç†è§£ç®—æ³•çš„æ‰§è¡Œè¿‡ç¨‹ã€‚
### ç¤ºä¾‹ï¼šè®¡ç®—æ–æ³¢é‚£å¥‘æ•°åˆ—
æ–æ³¢é‚£å¥‘æ•°åˆ—æ˜¯ä¸€ä¸ªç»å…¸çš„é€’å½’é—®é¢˜ç¤ºä¾‹ï¼š

def fibonacci(n):
    if n <= 0:
        return 0
    elif n == 1:
        return 1
    else:
        return fibonacci(n-1) + fibonacci(n-2)

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`fibonacci(n)` å‡½æ•°è®¡ç®—ç¬¬ `n` ä¸ªæ–æ³¢é‚£å¥‘æ•°ã€‚åŸºç¡€æƒ…å†µæ˜¯å½“ `n` ä¸º 0 æˆ– 1 æ—¶ï¼Œé€’å½’æ­¥éª¤æ˜¯è®¡ç®— `fibonacci(n-1)` å’Œ `fibonacci(n-2)` çš„å’Œã€‚
### è‡ªæˆ‘è¯„ä¼°ï¼š
âœ“ è¯¦ç»†è§£é‡Šäº†é€’å½’å‡½æ•°çš„åŸç†å’Œå®ç°æ­¥éª¤ã€‚
âœ“ æä¾›äº†é€’å½’çš„ä¼˜ç¼ºç‚¹å’Œé€‚ç”¨åœºæ™¯ã€‚
âœ“ é€šè¿‡æ–æ³¢é‚£å¥‘æ•°åˆ—çš„ä¾‹å­è¿›ä¸€æ­¥è¯´æ˜äº†é€’å½’çš„ä½¿ç”¨ã€‚
âœ“ å¯ä»¥è€ƒè™‘åŠ å…¥ä¸€äº›é€’å½’å‡½æ•°çš„æ½œåœ¨é—®é¢˜ï¼Œå¦‚æ ˆæº¢å‡ºï¼Œä»¥åŠå¦‚ä½•é¿å…è¿™äº›é—®é¢˜ã€‚
============================================================
ğŸ“Š æŠ€æœ¯è¯¦æƒ…:
  ğŸ“ ç±»å‹: AIMessage
  ğŸ’° Token: {'input_tokens': 206, 'output_tokens': 582, 'total_tokens': 788, 'input_token_details': {}, 'output_token_details': {}}
============================================================
```

## ğŸ›¡ï¸ æœ€ä½³å®è·µä¸æ³¨æ„äº‹é¡¹

### 1. æ¶ˆæ¯é¡ºåºç®¡ç†

```python
def message_order_best_practices():
    """æ¶ˆæ¯é¡ºåºæœ€ä½³å®è·µ"""
    
    # âœ… æ¨èçš„æ¶ˆæ¯é¡ºåº
    good_order = [
        SystemMessage("ç³»ç»Ÿè®¾å®š"),
        HumanMessage("ç”¨æˆ·é—®é¢˜1"),
        AIMessage("AIå›ç­”1"),
        HumanMessage("ç”¨æˆ·è¿½é—®"),
        # å½“å‰AIå›å¤ä¼šåŸºäºå®Œæ•´å†å²
    ]
    
    # âŒ é¿å…çš„æ¶ˆæ¯é¡ºåº
    bad_order = [
        HumanMessage("ç”¨æˆ·é—®é¢˜"),  # ç¼ºå°‘SystemMessage
        AIMessage("AIå›ç­”"),       # å¯èƒ½ç¼ºä¹ä¸Šä¸‹æ–‡
        SystemMessage("ç³»ç»Ÿè®¾å®š"), # å¤ªæ™šäº†ï¼Œæ— æ³•å½±å“å‰é¢çš„å¯¹è¯
    ]
    
    print("âœ… æ¨èé¡ºåºï¼šSystem â†’ Human â†’ AI â†’ Human â†’ AI")
    print("âŒ é¿å…é¡ºåºï¼šç¼ºå°‘SystemMessageæˆ–é¡ºåºæ··ä¹±")
```

### 2. ä¸Šä¸‹æ–‡é•¿åº¦æ§åˆ¶

```python
def context_length_management():
    """ä¸Šä¸‹æ–‡é•¿åº¦ç®¡ç†"""
    
    def trim_conversation_history(messages, max_tokens=2000):
        """æ™ºèƒ½è£å‰ªå¯¹è¯å†å²"""
        # ä¿ç•™æœ€è¿‘çš„äº¤äº’ï¼Œåˆ é™¤è¿‡æ—©çš„å†å²
        if len(messages) > 10:  # è¶…è¿‡10æ¡æ¶ˆæ¯
            # ä¿ç•™SystemMessage + æœ€è¿‘8æ¡äº¤äº’
            trimmed = [messages[0]] + messages[-8:]
            return trimmed
        return messages
    
    # ç¤ºä¾‹ä½¿ç”¨
    long_conversation = [
        SystemMessage("ä½ æ˜¯å®¢æœåŠ©æ‰‹"),
        # ... å¾ˆå¤šè½®å¯¹è¯å†å² ...
        HumanMessage("æœ€åä¸€ä¸ªé—®é¢˜")
    ]
    
    optimized_conversation = trim_conversation_history(long_conversation)
    print(f"ä¼˜åŒ–åæ¶ˆæ¯æ•°ï¼š{len(optimized_conversation)}")
```

### 3. è§’è‰²ä¸€è‡´æ€§ç»´æŠ¤

```python
def role_consistency_maintenance():
    """è§’è‰²ä¸€è‡´æ€§ç»´æŠ¤"""
    
    # ç¡®ä¿SystemMessageåœ¨æ•´ä¸ªå¯¹è¯ä¸­ä¿æŒä¸€è‡´
    consistent_system = SystemMessage("""
    è§’è‰²ï¼šä¸“ä¸šè¥å…»å¸ˆ
    è¯­è°ƒï¼šä¸“ä¸šä½†äº²åˆ‡
    çº¦æŸï¼šåªè®¨è®ºè¥å…»å¥åº·ç›¸å…³è¯é¢˜
    """)
    
    # åœ¨å¤šè½®å¯¹è¯ä¸­é‡å¤ä½¿ç”¨ç›¸åŒçš„SystemMessage
    conversation = [
        consistent_system,
        HumanMessage("å‡è‚¥æœŸé—´å¯ä»¥åƒä»€ä¹ˆï¼Ÿ"),
        AIMessage("å‡è‚¥æœŸé—´å»ºè®®é€‰æ‹©..."),
        HumanMessage("é‚£è¿åŠ¨æ–¹é¢å‘¢ï¼Ÿ"),
        # ç»§ç»­ä½¿ç”¨ç›¸åŒçš„consistent_system
    ]
    
    print("âœ… è§’è‰²ä¸€è‡´æ€§ï¼šåœ¨æ•´ä¸ªå¯¹è¯ä¸­ä¿æŒSystemMessageä¸å˜")
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. æ¶ˆæ¯ç¼“å­˜æœºåˆ¶

```python
class MessageCache:
    """æ¶ˆæ¯ç¼“å­˜ä¼˜åŒ–"""
    
    def __init__(self):
        self.cache = {}
    
    def get_cached_response(self, message_hash):
        """è·å–ç¼“å­˜çš„å“åº”"""
        return self.cache.get(message_hash)
    
    def cache_response(self, message_hash, response):
        """ç¼“å­˜å“åº”"""
        self.cache[message_hash] = response
        # é™åˆ¶ç¼“å­˜å¤§å°
        if len(self.cache) > 100:
            # åˆ é™¤æœ€æ—§çš„ç¼“å­˜é¡¹
            oldest_key = next(iter(self.cache))
            del self.cache[oldest_key]

# ä½¿ç”¨ç¤ºä¾‹
cache = MessageCache()
```

### 2. æ‰¹é‡æ¶ˆæ¯å¤„ç†

```python
def batch_message_processing():
    """æ‰¹é‡æ¶ˆæ¯å¤„ç†ä¼˜åŒ–"""
    
    model = init_chat_model(model="Qwen/Qwen3-8B")
    
    # å‡†å¤‡æ‰¹é‡æŸ¥è¯¢
    batch_queries = [
        HumanMessage("Pythonåˆ—è¡¨å’Œå…ƒç»„çš„åŒºåˆ«ï¼Ÿ"),
        HumanMessage("ä»€ä¹ˆæ˜¯è£…é¥°å™¨ï¼Ÿ"),
        HumanMessage("å¦‚ä½•å¤„ç†å¼‚å¸¸ï¼Ÿ")
    ]
    
    # æ‰¹é‡å¤„ç†ï¼ˆå¦‚æœæ¨¡å‹æ”¯æŒï¼‰
    responses = []
    for query in batch_queries:
        response = model.invoke([query])
        responses.append(response.content)
    
    for i, response in enumerate(responses, 1):
        print(f"é—®é¢˜{i}çš„å›ç­”ï¼š{response}")
```

## ğŸ¨ å®ç”¨å·¥å…·å‡½æ•°

### 1. æ¶ˆæ¯æ„å»ºå™¨

```python
class MessageBuilder:
    """æ¶ˆæ¯æ„å»ºå™¨å·¥å…·"""
    
    def __init__(self):
        self.messages = []
    
    def add_system(self, content):
        """æ·»åŠ ç³»ç»Ÿæ¶ˆæ¯"""
        from langchain_core.messages import SystemMessage
        self.messages.append(SystemMessage(content))
        return self
    
    def add_human(self, content):
        """æ·»åŠ ç”¨æˆ·æ¶ˆæ¯"""
        from langchain_core.messages import HumanMessage
        self.messages.append(HumanMessage(content))
        return self
    
    def add_ai(self, content):
        """æ·»åŠ AIæ¶ˆæ¯"""
        from langchain_core.messages import AIMessage
        self.messages.append(AIMessage(content))
        return self
    
    def build(self):
        """æ„å»ºæ¶ˆæ¯åˆ—è¡¨"""
        return self.messages

# ä½¿ç”¨ç¤ºä¾‹
def builder_example():
    builder = MessageBuilder()
    conversation = (builder
                   .add_system("ä½ æ˜¯ä¸€ä¸ªå¹½é»˜çš„èŠå¤©æœºå™¨äºº")
                   .add_human("ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ")
                   .add_ai("ä»Šå¤©å¤©æ°”å¥½å¾—åƒæ˜¯ä¸“é—¨ä¸ºç¬‘è¯è€Œç”Ÿçš„ï¼")
                   .add_human("å“ˆå“ˆï¼Œä½ çœŸå¹½é»˜")
                   .build())
    
    model = init_chat_model(model="Qwen/Qwen3-8B")
    response = model.invoke(conversation)
    print("æ„å»ºå™¨ç”Ÿæˆçš„å¯¹è¯ï¼š", response.content)
```

### 2. å¯¹è¯å†å²ç®¡ç†å™¨

```python
class ConversationHistory:
    """å¯¹è¯å†å²ç®¡ç†å™¨"""
    
    def __init__(self, max_length=20):
        self.history = []
        self.max_length = max_length
    
    def add_message(self, message):
        """æ·»åŠ æ¶ˆæ¯åˆ°å†å²"""
        self.history.append(message)
        # æ§åˆ¶å†å²é•¿åº¦
        if len(self.history) > self.max_length:
            # ä¿ç•™SystemMessageå’Œæœ€è¿‘çš„æ¶ˆæ¯
            system_msg = self.history[0] if isinstance(self.history[0].__class__.__name__, 'SystemMessage') else None
            self.history = [system_msg] + self.history[-(self.max_length-1):] if system_msg else self.history[-self.max_length:]
    
    def get_context(self):
        """è·å–å½“å‰å¯¹è¯ä¸Šä¸‹æ–‡"""
        return self.history.copy()
    
    def clear(self):
        """æ¸…ç©ºå¯¹è¯å†å²"""
        self.history.clear()

# ä½¿ç”¨ç¤ºä¾‹
def history_manager_example():
    history = ConversationHistory(max_length=10)
    
    # æ¨¡æ‹Ÿå¯¹è¯è¿‡ç¨‹
    history.add_message(SystemMessage("ä½ æ˜¯ä¸€ä¸ªå‹å¥½çš„åŠ©æ‰‹"))
    history.add_message(HumanMessage("ä½ å¥½ï¼"))
    history.add_message(AIMessage("ä½ å¥½ï¼æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ"))
    history.add_message(HumanMessage("æˆ‘æƒ³äº†è§£Python"))
    
    current_context = history.get_context()
    print(f"å½“å‰ä¸Šä¸‹æ–‡åŒ…å« {len(current_context)} æ¡æ¶ˆæ¯")
```

## ğŸ“ æ€»ç»“

æ¶ˆæ¯ç³»ç»Ÿæ˜¯LangChainå¯¹è¯åº”ç”¨çš„æ ¸å¿ƒåŸºç¡€ï¼š

âœ… **SystemMessage**ï¼šç²¾ç¡®æ§åˆ¶AIè¡Œä¸ºå’Œè§’è‰²å®šä½  
âœ… **HumanMessage**ï¼šç”¨æˆ·äº¤äº’çš„ä¸»è¦å…¥å£  
âœ… **AIMessage**ï¼šç»´æŠ¤å¯¹è¯å†å²å’Œä¸Šä¸‹æ–‡è¿è´¯æ€§  
âœ… **ç»„åˆä½¿ç”¨**ï¼šå¤šç§æ¶ˆæ¯ç±»å‹åè°ƒæ„å»ºå¤æ‚å¯¹è¯åœºæ™¯  
âœ… **æœ€ä½³å®è·µ**ï¼šæ³¨æ„æ¶ˆæ¯é¡ºåºã€ä¸Šä¸‹æ–‡ç®¡ç†å’Œè§’è‰²ä¸€è‡´æ€§  

## ğŸ”— ç›¸å…³èµ„æº

- [LangChain Messages Documentation](https://docs.langchain.com/oss/python/langchain/messages)
- [Chat Models Guide](https://docs.langchain.com/oss/python/langchain/models)

---
*æœ¬æ•™ç¨‹æ·±å…¥è§£æäº†æ¶ˆæ¯ç³»ç»Ÿçš„æ ¸å¿ƒæŠ€æœ¯ã€‚ä¸‹ä¸€æœŸæˆ‘ä»¬å°†æ¢ç´¢ToolMessageå’Œå·¥å…·è°ƒç”¨çš„é«˜çº§åº”ç”¨ã€‚*