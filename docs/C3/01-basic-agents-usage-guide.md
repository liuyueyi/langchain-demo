# LangChainå®æˆ˜å¼€å‘æ•™ç¨‹ï¼ˆåäºŒï¼‰ï¼šæ™ºèƒ½ä½“åŸºç¡€ä½¿ç”¨ä¸äº¤äº’å®æˆ˜

> **{æŠ€æœ¯æ ˆ}å®æˆ˜ï¼šä»é›¶æ­å»º{æ™ºèƒ½ä½“åº”ç”¨}**

## ğŸ¯ æœ¬æ–‡ç›®æ ‡

æ·±å…¥ç†è§£LangChain Agentsçš„æ ¸å¿ƒæœºåˆ¶ï¼ŒæŒæ¡æ™ºèƒ½ä½“çš„åˆ›å»ºã€é…ç½®å’Œäº¤äº’æ–¹æ³•ï¼Œå­¦ä¼šæ„å»ºå…·å¤‡è‡ªä¸»å†³ç­–èƒ½åŠ›çš„AIåº”ç”¨ã€‚

### ğŸ“š æ ¸å¿ƒçŸ¥è¯†ç‚¹æ¦‚è§ˆ

é€šè¿‡æœ¬æ–‡ä½ å°†æŒæ¡ï¼š
- **Agentåˆ›å»ºæœºåˆ¶**ï¼šcreate_agent()å‡½æ•°çš„æ ¸å¿ƒå‚æ•°å’Œé…ç½®
- **å·¥å…·é›†æˆæ–¹å¼**ï¼šå¦‚ä½•å°†è‡ªå®šä¹‰å·¥å…·ç»‘å®šåˆ°æ™ºèƒ½ä½“
- **äº¤äº’æ¨¡å¼å¯¹æ¯”**ï¼šåŒæ­¥è°ƒç”¨ vs æµå¼è°ƒç”¨çš„åŒºåˆ«å’Œåº”ç”¨
- **å†³ç­–è¿‡ç¨‹è§‚å¯Ÿ**ï¼šå¦‚ä½•ç›‘æ§Agentçš„æ€è€ƒå’Œæ‰§è¡Œè¿‡ç¨‹
- **ç³»ç»Ÿæç¤ºè¯è®¾è®¡**ï¼šå¼•å¯¼Agentè¡Œä¸ºçš„å…³é”®è¦ç´ 

### ğŸ¯ ä½¿ç”¨åœºæ™¯åˆ¤æ–­

âœ… **æ¨èä½¿ç”¨Agents**ï¼š
- éœ€è¦å¤šæ­¥éª¤è§£å†³é—®é¢˜çš„å¤æ‚ä»»åŠ¡
- è¦æ±‚AIå…·å¤‡è‡ªä¸»å†³ç­–èƒ½åŠ›çš„åœºæ™¯
- éœ€è¦ç¼–æ’å¤šä¸ªå·¥å…·ååŒå·¥ä½œçš„åº”ç”¨
- æ™ºèƒ½å®¢æœå’ŒåŠ©æ‰‹ç±»åº”ç”¨å¼€å‘
- è‡ªåŠ¨åŒ–å·¥ä½œæµå’Œä»»åŠ¡å¤„ç†

âŒ **ä¸å»ºè®®ä½¿ç”¨**ï¼š
- ç®€å•å•è½®é—®ç­”åœºæ™¯
- å¯¹å“åº”æ—¶é—´è¦æ±‚æé«˜çš„å®æ—¶åº”ç”¨
- ä¸éœ€è¦å·¥å…·è°ƒç”¨çš„çº¯æ–‡æœ¬ç”Ÿæˆ
- ç®€å•çš„APIå°è£…åœºæ™¯

### ğŸ’¡ æ ¸å¿ƒæ¦‚å¿µè§£é‡Š

**Agentï¼ˆæ™ºèƒ½ä½“ï¼‰**ï¼šå…·å¤‡è‡ªä¸»å†³ç­–èƒ½åŠ›çš„AIç³»ç»Ÿï¼Œèƒ½å¤Ÿç†è§£ç”¨æˆ·éœ€æ±‚ã€é€‰æ‹©åˆé€‚å·¥å…·ã€æ‰§è¡Œä»»åŠ¡å¹¶è¿”å›ç»“æœçš„å®Œæ•´è§£å†³æ–¹æ¡ˆã€‚

## ğŸ”§ å®æ–½ä¸‰æ­¥èµ°

### æ­¥éª¤1ï¼šAgentç¯å¢ƒé…ç½®ä¸å·¥å…·å‡†å¤‡ âš™ï¸

**å‰ç½®æ¡ä»¶**ï¼š
- æŒæ¡åŸºç¡€å·¥å…·å®šä¹‰å’Œæ³¨å†Œ
- ç†è§£LLMæ¨¡å‹é…ç½®å’Œåˆå§‹åŒ–
- ç†Ÿæ‚‰æ¶ˆæ¯ç³»ç»Ÿå’Œå¯¹è¯ç®¡ç†

```python
import os
from dotenv import load_dotenv
from langchain.agents import create_agent
from langchain.chat_models import init_chat_model
from langchain.tools import tool
from langchain_core.messages import HumanMessage

# ç¯å¢ƒé…ç½®
config_path = os.path.join(os.path.dirname(os.path.dirname(os.path.dirname(__file__))), 'config.env')
load_dotenv(config_path)

os.environ["OPENAI_API_KEY"] = os.getenv('API_KEY')
os.environ["OPENAI_BASE_URL"] = os.getenv('BASE_URL')
model_name = os.getenv('MODEL')

def init_model(model=model_name):
    """åˆå§‹åŒ–LLMæ¨¡å‹"""
    return init_chat_model(
        model=model,
        model_provider="openai",
        temperature=0.7,
        timeout=30,
        max_tokens=1000,
        max_retries=3,
    )

# åŸºç¡€å·¥å…·å®šä¹‰
@tool
def calculator(num1: float, operation: str, num2: float) -> float:
    """
    æ‰§è¡ŒåŸºæœ¬æ•°å­¦è¿ç®—çš„è®¡ç®—å™¨å·¥å…·
    
    Args:
        num1: ç¬¬ä¸€ä¸ªæ•°å­—
        operation: è¿ç®—ç¬¦ (+, -, *, /)
        num2: ç¬¬äºŒä¸ªæ•°å­—
        
    Returns:
        float: è®¡ç®—ç»“æœ
    """
    print(f"ğŸ§® æ‰§è¡Œè®¡ç®—: {num1} {operation} {num2}")
    
    if operation == "+":
        return num1 + num2
    elif operation == "-":
        return num1 - num2
    elif operation == "*":
        return num1 * num2
    elif operation == "/":
        if num2 == 0:
            raise ValueError("é™¤æ•°ä¸èƒ½ä¸ºé›¶")
        return num1 / num2
    else:
        raise ValueError(f"ä¸æ”¯æŒçš„è¿ç®—ç¬¦: {operation}")

@tool
def weather_checker(city: str) -> str:
    """
    æŸ¥è¯¢åŸå¸‚å¤©æ°”ä¿¡æ¯çš„å·¥å…·
    
    Args:
        city: åŸå¸‚åç§°
        
    Returns:
        str: å¤©æ°”ä¿¡æ¯
    """
    print(f"ğŸŒ¤ï¸ æŸ¥è¯¢ {city} çš„å¤©æ°”")
    # æ¨¡æ‹Ÿå¤©æ°”æ•°æ®
    weather_data = {
        "åŒ—äº¬": "æ™´å¤©ï¼Œæ¸©åº¦ 15Â°C",
        "ä¸Šæµ·": "å¤šäº‘ï¼Œæ¸©åº¦ 18Â°C",
        "å¹¿å·": "é›¨å¤©ï¼Œæ¸©åº¦ 22Â°C",
        "æ·±åœ³": "é˜´å¤©ï¼Œæ¸©åº¦ 20Â°C",
        "æ­å·": "æ™´å¤©ï¼Œæ¸©åº¦ 16Â°C"
    }
    return weather_data.get(city, f"æš‚æ—  {city} çš„å¤©æ°”ä¿¡æ¯")
```

### æ­¥éª¤2ï¼šAgentåˆ›å»ºä¸åŸºç¡€äº¤äº’ ğŸš€

**Agentåˆ›å»ºæ ¸å¿ƒè¦ç´ è¯¦è§£**

create_agent()å‡½æ•°å…³é”®å‚æ•°ï¼š

1. model: LLMæ¨¡å‹å®ä¾‹
   - æä¾›æ™ºèƒ½å†³ç­–å’Œè‡ªç„¶è¯­è¨€ç†è§£èƒ½åŠ›
   - æ˜¯Agentçš„"å¤§è„‘"

2. tools: å·¥å…·åˆ—è¡¨
   - Agentå¯è°ƒç”¨çš„å¤–éƒ¨åŠŸèƒ½é›†åˆ
   - æ˜¯Agentçš„"æ‰‹è„š"

3. system_prompt: ç³»ç»Ÿæç¤ºè¯
   - å®šä¹‰Agentçš„è§’è‰²å®šä½å’Œè¡Œä¸ºå‡†åˆ™
   - æ˜¯Agentçš„"æ€§æ ¼"å’Œ"ä»·å€¼è§‚"

4. å…¶ä»–å¯é€‰å‚æ•°ï¼š
   - response_format: ç»“æ„åŒ–è¿”å›
   - checkpointer: ç”¨äºä¸Šä¸‹æ–‡æ¢å¤

```python
def basic_agent_demo():
    """åŸºç¡€Agentä½¿ç”¨æ¼”ç¤º"""
    print("ğŸš€ å¼€å§‹ LangChain Agents åŸºç¡€ç¤ºä¾‹æ¼”ç¤º")
    
    # åˆ›å»ºAgentçš„æ ¸å¿ƒè¦ç´ 
    llm = init_model()
    tools = [calculator]  # å·¥å…·åˆ—è¡¨
    
    # åˆ›å»ºAgent - æ ¸å¿ƒå‚æ•°è¯´æ˜
    agent = create_agent(
        model=llm,  # LLMæ¨¡å‹å®ä¾‹
        tools=tools,  # å¯ç”¨å·¥å…·åˆ—è¡¨
        system_prompt="ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½åŠ©æ‰‹ï¼Œå¯ä»¥æ ¹æ®ç”¨æˆ·çš„é—®é¢˜é€‰æ‹©åˆé€‚çš„å·¥å…·æ¥å¸®åŠ©è§£å†³é—®é¢˜ã€‚"
        # system_prompt: ç³»ç»Ÿæç¤ºè¯ï¼Œå®šä¹‰Agentçš„è¡Œä¸ºå‡†åˆ™å’Œè§’è‰²å®šä½
    )
    
    # æµ‹è¯•ç”¨ä¾‹è®¾è®¡
    test_queries = [
        "å¸®æˆ‘ä»‹ç»ä¸€ä¸‹æç™½çš„ç”Ÿå¹³",  # çº¯æ–‡æœ¬é—®ç­”
        "ä»Šå¤©å¤©æ°”ä¸é”™ï¼Œå¸®æˆ‘æ¨èå‡ ä¸ªæœ‰è¶£çš„æ¸¸æˆ",  # éœ€è¦æ¨ç†çš„ä»»åŠ¡
        "å…ˆè®¡ç®— 100 é™¤ä»¥ 5ï¼Œç„¶åå‘Šè¯‰æˆ‘ä¸Šæµ·çš„å¤©æ°”"  # å¤šæ­¥éª¤å¤åˆä»»åŠ¡
    ]
    
    print(f"\nğŸ¯ å¼€å§‹æµ‹è¯• {len(test_queries)} ä¸ªé—®é¢˜:")
    
    for i, query in enumerate(test_queries, 1):
        print(f"\n{'=' * 20} æµ‹è¯• {i}/{len(test_queries)} {'=' * 20}")
        print(f"â“ é—®é¢˜: {query}")
        
        try:
            # Agentè°ƒç”¨æ–¹å¼ - è¾“å…¥æ ¼å¼è¯´æ˜
            inputs = {"messages": [{"role": "user", "content": query}]}
            # æ”¯æŒä¸¤ç§æ¶ˆæ¯æ ¼å¼ï¼š
            # 1. å­—å…¸æ ¼å¼: {"role": "user", "content": "å†…å®¹"}
            # 2. æ¶ˆæ¯å¯¹è±¡: HumanMessage("å†…å®¹")
            
            # åŒæ­¥è°ƒç”¨ - ç›´æ¥è·å–æœ€ç»ˆç»“æœ
            response = agent.invoke(inputs)
            
            # å¯¹è¯å†å²æŸ¥çœ‹ - Agentçš„å®Œæ•´æ‰§è¡Œè¿‡ç¨‹
            print("ğŸ’¬ å¯¹è¯å†å²:")
            for msg in response["messages"]:
                if hasattr(msg, 'content'):
                    print(f"   {msg.type}: {msg.content}")
                elif isinstance(msg, dict):
                    print(f"   {msg.get('role', 'unknown')}: {msg.get('content', '')}")
                    
        except Exception as e:
            print(f"âŒ æ‰§è¡Œå‡ºé”™: {e}")
            continue
```

ä¸€æ¬¡äº¤äº’çš„è¾“å‡ºå¦‚ä¸‹(å…¶ä¸­å‰é¢ä¸¤ä¸ªé—®é¢˜æ²¡æœ‰è§¦å‘å·¥å…·çš„è°ƒç”¨ï¼Œç›´æ¥æ‹¿åˆ°å¤§æ¨¡å‹çš„è¿”å›è¿›è¡Œè¾“å‡º)

```text
ğŸ¤– LangChain Agents åŸºç¡€ä½¿ç”¨ç¤ºä¾‹
==================================================
ğŸš€ å¼€å§‹ LangChain Agents åŸºç¡€ç¤ºä¾‹æ¼”ç¤º

ğŸ¯ å¼€å§‹æµ‹è¯• 3 ä¸ªé—®é¢˜:

==================== æµ‹è¯• 1/3 ====================
â“ é—®é¢˜: å¸®æˆ‘ä»‹ç»ä¸€ä¸‹æç™½çš„ç”Ÿå¹³
ğŸ’¬ å¯¹è¯å†å²:
   human: å¸®æˆ‘ä»‹ç»ä¸€ä¸‹æç™½çš„ç”Ÿå¹³
   ai: æç™½ï¼ˆ701å¹´ï¼762å¹´ï¼‰ï¼Œå­—å¤ªç™½ï¼Œå·é’è²å±…å£«ï¼Œå”ä»£è‘—åè¯—äººï¼Œæœ‰â€œè¯—ä»™â€ä¹‹ç§°ã€‚ä»¥ä¸‹æ˜¯æç™½ç”Ÿå¹³çš„ç®€è¦ä»‹ç»ï¼š

1. æ—©å¹´ç»å†ï¼š
   - æç™½å‡ºç”Ÿäºä»Šç”˜è‚ƒçœå¤©æ°´å¸‚ï¼Œç¥–ç±é™‡è¥¿æˆçºªï¼ˆä»Šç”˜è‚ƒçœç§¦å®‰å¿ï¼‰ã€‚
   - æç™½è‡ªå¹¼èªé¢–è¿‡äººï¼Œå¥½å­¦ä¸å€¦ï¼Œå°¤æ“…é•¿ä¹¦æ³•å’Œè¯—æ­Œã€‚

2. ä»•é€”ï¼š
   - æç™½é’å¹´æ—¶æœŸï¼Œæ›¾è¯•å›¾é€šè¿‡ç§‘ä¸¾è€ƒè¯•è¿›å…¥ä»•é€”ï¼Œä½†å±¡è¯•ä¸ä¸­ã€‚
   - å”ç„å®—å¼€å…ƒå¹´é—´ï¼Œæç™½ç»“è¯†äº†æœç”«ã€ç‹ç»´ç­‰è¯—å‹ï¼Œå¼€å§‹åˆ›ä½œè¯—æ­Œã€‚

3. è¯—æ­Œåˆ›ä½œï¼š
   - æç™½ä¸€ç”Ÿåˆ›ä½œäº†å¤§é‡è¯—æ­Œï¼Œé¢˜æå¹¿æ³›ï¼Œé£æ ¼è±ªæ”¾ï¼Œå–„äºè¿ç”¨å¤¸å¼ ã€æ¯”å–»ç­‰æ‰‹æ³•ï¼Œå…·æœ‰å¾ˆé«˜çš„è‰ºæœ¯æˆå°±ã€‚
   - ä»–çš„è¯—æ­Œä»£è¡¨ä½œæœ‰ã€Šå°†è¿›é…’ã€‹ã€ã€Šåºå±±è°£ã€‹ã€ã€Šå¤œæ³Šç‰›æ¸šæ€€å¤ã€‹ç­‰ã€‚

4. æµæ”¾ä¸æ™šå¹´ï¼š
   - æç™½å› å—æƒè´µæ’æŒ¤ï¼Œæ›¾ä¸¤æ¬¡è¢«è´¬è°ªã€‚ç¬¬ä¸€æ¬¡æ˜¯å› åå¯¹å”ç„å®—çš„å¥¢ä¾ˆç”Ÿæ´»è€Œè¢«è´¬ä¸ºæ±Ÿé™µå°‰ï¼›ç¬¬äºŒæ¬¡æ˜¯å› å‚ä¸ææ—ç”«é›†å›¢çš„æ”¿æ²»æ–—äº‰è€Œè¢«è´¬ä¸ºå¤œéƒï¼ˆä»Šè´µå·å¢ƒå†…ï¼‰ã€‚
   - æ™šå¹´ï¼Œæç™½å›åˆ°æ±Ÿå®ï¼ˆä»Šå—äº¬å¸‚ï¼‰ï¼Œç”Ÿæ´»è´«å›°ï¼Œä½†ä»ç„¶åšæŒåˆ›ä½œã€‚
   - 762å¹´ï¼Œæç™½ç—…é€äºå®£åŸï¼ˆä»Šå®‰å¾½çœå®£åŸå¸‚ï¼‰ã€‚

5. å†å²è¯„ä»·ï¼š
   - æç™½æ˜¯å”ä»£æœ€ä¼Ÿå¤§çš„è¯—äººä¹‹ä¸€ï¼Œå…¶è¯—æ­Œåœ¨ä¸­å›½æ–‡å­¦å²ä¸Šå æœ‰é‡è¦åœ°ä½ã€‚
   - æç™½çš„è¯—æ­Œå…·æœ‰å¾ˆé«˜çš„è‰ºæœ¯ä»·å€¼ï¼Œå¯¹åä¸–æ–‡å­¦äº§ç”Ÿäº†æ·±è¿œå½±å“ã€‚

æ€»ä¹‹ï¼Œæç™½æ˜¯ä¸€ä½æ‰åæ¨ªæº¢ã€ä¸ªæ€§é²œæ˜çš„è¯—äººï¼Œä»–çš„è¯—æ­Œä½œå“è‡³ä»Šä»ä¸ºäººä»¬æ‰€ä¼ é¢‚ã€‚

==================== æµ‹è¯• 2/3 ====================
â“ é—®é¢˜: ä»Šå¤©å¤©æ°”ä¸é”™ï¼Œå¸®æˆ‘æ¨èå‡ ä¸ªæœ‰è¶£çš„æ¸¸æˆ
ğŸ’¬ å¯¹è¯å†å²:
   human: ä»Šå¤©å¤©æ°”ä¸é”™ï¼Œå¸®æˆ‘æ¨èå‡ ä¸ªæœ‰è¶£çš„æ¸¸æˆ
   ai: æ¨èæ¸¸æˆä¹‹å‰ï¼Œæˆ‘æƒ³äº†è§£ä¸€ä¸‹æ‚¨å¹³æ—¶å–œæ¬¢ç©ä»€ä¹ˆç±»å‹çš„æ¸¸æˆï¼Ÿæ¯”å¦‚è§’è‰²æ‰®æ¼”ã€ç­–ç•¥ã€å°„å‡»ã€ä¼‘é—²ç­‰ã€‚è¿™æ ·æˆ‘å¯ä»¥æ›´å‡†ç¡®åœ°ä¸ºæ‚¨æ¨èé€‚åˆçš„æ¸¸æˆã€‚

==================== æµ‹è¯• 3/3 ====================
â“ é—®é¢˜: å…ˆè®¡ç®— 100 é™¤ä»¥ 5ï¼Œç„¶åå‘Šè¯‰æˆ‘ä¸Šæµ·çš„å¤©æ°”
ğŸ§® æ‰§è¡Œè®¡ç®—: 100.0 / 5.0
ğŸ’¬ å¯¹è¯å†å²:
   human: å…ˆè®¡ç®— 100 é™¤ä»¥ 5ï¼Œç„¶åå‘Šè¯‰æˆ‘ä¸Šæµ·çš„å¤©æ°”
   ai: 
   tool: 20.0
   ai: ä¸Šæµ·çš„å¤©æ°”æ˜¯ï¼šå¤šäº‘ï¼Œæ¸©åº¦çº¦ä¸º24â„ƒã€‚
```

### æ­¥éª¤3ï¼šæµå¼è°ƒç”¨ä¸è¿‡ç¨‹ç›‘æ§ âš¡

Agentæµå¼è°ƒç”¨åŸºæœ¬æµç¨‹ä¸ä¸Šé¢çš„åŒæ­¥è°ƒç”¨ä¸€è‡´ï¼Œä¸‹é¢çš„å®ç°ä¸­ï¼Œä¼ å…¥çš„æ¶ˆæ¯ä½¿ç”¨äº† HumanMessage æ›¿æ¢äº†ä¸Šé¢çš„Dictè¾“å…¥æ–¹å¼ï¼Œä¸¤è€…æœ€ç»ˆæ•ˆæœæ˜¯ä¸€è‡´çš„ï¼›

é‡ç‚¹å…³æ³¨ä¸€ä¸‹æµå¼çš„è¿”å›ï¼Œä»è¿”å›ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸‹é¢å››ç§æ¶ˆæ¯çš„ï¼š

1. HumanMessageï¼ˆç”¨æˆ·è¾“å…¥ï¼‰
   - ç”¨æˆ·æå‡ºé—®é¢˜æˆ–è¯·æ±‚
   - Agentæ¥æ”¶å¹¶ç†è§£ä»»åŠ¡

2. AIMessageï¼ˆæ¨¡å‹åˆå§‹å“åº”ï¼‰
   - Agentåˆ†æé—®é¢˜å¹¶åˆ¶å®šæ‰§è¡Œè®¡åˆ’
   - å†³å®šéœ€è¦è°ƒç”¨å“ªäº›å·¥å…·

3. ToolMessageï¼ˆå·¥å…·è°ƒç”¨ç»“æœï¼‰
   - æ‰§è¡Œé€‰å®šçš„å·¥å…·å‡½æ•°
   - è·å–å·¥å…·æ‰§è¡Œç»“æœ

4. æœ€ç»ˆçš„AIMessageï¼ˆæ€»ç»“å›ç­”ï¼‰
   - æ•´åˆæ‰€æœ‰ä¿¡æ¯ç”Ÿæˆæœ€ç»ˆå›ç­”
   - æä¾›å®Œæ•´çš„è§£å†³æ–¹æ¡ˆ

å¯¹äºå·¥å…·çš„è°ƒç”¨ï¼Œä¹‹å‰ç›´æ¥ä½¿ç”¨modelæ—¶ï¼Œæ˜¯éœ€è¦æˆ‘ä»¬å“åº”å¤§æ¨¡å‹çš„tool_callsï¼Œç„¶åè‡ªå·±æ¥å®ç°å·¥å…·çš„è°ƒç”¨æµç¨‹ï¼›ä½†æ˜¯åœ¨Agentä¸­ï¼Œè¿™äº›æ˜¯ä¸éœ€è¦æˆ‘ä»¬é¢å¤–å¤„ç†çš„ï¼ŒAgentå·²ç»å°†ç›¸å…³çš„è¿‡ç¨‹é›†æˆäº†ï¼Œæˆ‘ä»¬åªç”¨å…³æ³¨æœ€ç»ˆçš„ç»“æœå³å¯


```python
def stream_demo():
    """æµå¼è°ƒç”¨æ¼”ç¤º - è§‚å¯ŸAgentå†³ç­–è¿‡ç¨‹"""
    print("\nğŸ¯ Streamè®¿é—®æ¼”ç¤º:")
    
    llm = init_model()
    tools = [calculator, weather_checker]
    
    # å¢å¼ºç‰ˆç³»ç»Ÿæç¤ºè¯
    agent = create_agent(
        llm, 
        tools, 
        system_prompt="""ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ™ºèƒ½åŠ©æ‰‹ï¼Œå…·æœ‰ä»¥ä¸‹èƒ½åŠ›ï¼š
        1. æ•°å­¦è®¡ç®— - å¯ä»¥è¿›è¡Œå„ç§æ•°å­¦è¿ç®—
        2. å¤©æ°”æŸ¥è¯¢ - å¯ä»¥æŸ¥è¯¢ä¸­å›½ä¸»è¦åŸå¸‚çš„å¤©æ°”
        
        è¯·æ ¹æ®ç”¨æˆ·çš„é—®é¢˜é€‰æ‹©æœ€åˆé€‚çš„å·¥å…·æ¥è§£å†³é—®é¢˜ã€‚
        å¦‚æœé—®é¢˜æ¶‰åŠå¤šä¸ªæ­¥éª¤ï¼Œè¯·ä¾æ¬¡æ‰§è¡Œç›¸åº”çš„å·¥å…·è°ƒç”¨ã€‚
        å›ç­”æ—¶è¦æ¸…æ™°ã€å‡†ç¡®ï¼Œå¹¶ç»™å‡ºå®Œæ•´çš„è§£å†³æ–¹æ¡ˆã€‚"""
    )
    
    queries = [
        "è®¡ç®— 5 * 8",
        "æ¯”è¾ƒä¸€ä¸‹åŒ—äº¬å’Œä¸Šæµ·ä»Šå¤©çš„å¤©æ°”å“ªä¸ªæ›´å¥½"
    ]
    
    for query in queries:
        print(f"\nâ“ é—®é¢˜: {query}")
        try:
            inputs = {"messages": [HumanMessage(query)]}
            
            # æµå¼è°ƒç”¨ - å®æ—¶è§‚å¯Ÿå†³ç­–è¿‡ç¨‹
            print("ğŸ’¬ å¯¹è¯å†å²:")
            last_type = None
            
            # stream_mode="values" - æ¯ä¸ªæ‰§è¡Œæ­¥éª¤å®Œæˆåä¼ è¾“ä¸­é—´æ•°æ®
            for step in agent.stream(inputs, stream_mode="values"):
                msg = step['messages'][-1]  # è·å–æœ€æ–°æ¶ˆæ¯
                
                # ç¾åŒ–è¾“å‡ºæ ¼å¼
                if last_type != msg.type:
                    print(f"\n   {msg.type}: ", end='')
                    last_type = msg.type
                print(msg.content, end='', flush=True)
            
            print("\n\n")
            
        except Exception as e:
            print(f"âŒ æ‰§è¡Œå‡ºé”™: {e}")
```

ä¸€æ¬¡è°ƒç”¨çš„è¾“å‡ºå¦‚ä¸‹

```text
ğŸ¯ Streamè®¿é—®æ¼”ç¤º:

â“ é—®é¢˜: è®¡ç®— 5 * 8
ğŸ’¬ å¯¹è¯å†å²:

   human: è®¡ç®— 5 * 8
   ai: ğŸ§® æ‰§è¡Œè®¡ç®—: 5.0 * 8.0

   tool: 40.0
   ai: åˆ†æã€Œè®¡ç®— 5 * 8ã€è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¯·æ±‚è®¡ç®—å™¨APIå¾—åˆ°ç­”æ¡ˆã€‚æ ¹æ®APIè°ƒç”¨ç»“æœï¼Œ5 * 8 çš„ç­”æ¡ˆä¸º 40.0ã€‚



â“ é—®é¢˜: æ¯”è¾ƒä¸€ä¸‹åŒ—äº¬å’Œä¸Šæµ·ä»Šå¤©çš„å¤©æ°”å“ªä¸ªæ›´å¥½
ğŸ’¬ å¯¹è¯å†å²:

   human: æ¯”è¾ƒä¸€ä¸‹åŒ—äº¬å’Œä¸Šæµ·ä»Šå¤©çš„å¤©æ°”å“ªä¸ªæ›´å¥½
   ai: ğŸŒ¤ï¸ æŸ¥è¯¢ åŒ—äº¬ çš„å¤©æ°”

   tool: æ™´å¤©ï¼Œæ¸©åº¦ 15Â°C
   ai: ğŸŒ¤ï¸ æŸ¥è¯¢ ä¸Šæµ· çš„å¤©æ°”

   tool: å¤šäº‘ï¼Œæ¸©åº¦ 18Â°C
   ai: æ ¹æ®å¤©æ°”æŸ¥è¯¢å·¥å…·ï¼Œä»Šå¤©åŒ—äº¬çš„å¤©æ°”ä¸ºæ™´å¤©ï¼Œæ¸©åº¦ä¸º15Â°Cï¼Œè€Œä¸Šæµ·çš„å¤©æ°”ä¸ºå¤šäº‘ï¼Œæ¸©åº¦ä¸º18Â°Cã€‚å› æ­¤ï¼ŒåŒ—äº¬ä»Šå¤©çš„å¤©æ°”æ¯”ä¸Šæµ·æ›´å¥½ã€‚
```

## â“ å¸¸è§é—®é¢˜è§£ç­”

**Q1**: Agentå’Œæ™®é€šå·¥å…·è°ƒç”¨æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ
**A1**: 

| ç‰¹æ€§ | æ™®é€šå·¥å…·è°ƒç”¨ | Agent |
|------|-------------|-------|
| å†³ç­–èƒ½åŠ› | æ— ï¼Œéœ€è¦å¼€å‘è€…æ‰‹åŠ¨æŒ‡å®š | æœ‰ï¼Œè‡ªåŠ¨é€‰æ‹©åˆé€‚å·¥å…· |
| æ‰§è¡Œæµç¨‹ | å•æ­¥æ‰§è¡Œ | å¤šæ­¥ç¼–æ’æ‰§è¡Œ |
| å¤æ‚åº¦ | ç®€å•ç›´æ¥ | å¯å¤„ç†å¤æ‚ä»»åŠ¡ |
| å¼€å‘æˆæœ¬ | ä½ | ç›¸å¯¹è¾ƒé«˜ |
| é€‚ç”¨åœºæ™¯ | ç®€å•åŠŸèƒ½è°ƒç”¨ | å¤æ‚é—®é¢˜è§£å†³ |

```python
# æ™®é€šå·¥å…·è°ƒç”¨ - éœ€è¦æ‰‹åŠ¨ç¼–æ’
def manual_tool_usage():
    # å¼€å‘è€…éœ€è¦æ˜ç¡®çŸ¥é“è°ƒç”¨å“ªä¸ªå·¥å…·
    result1 = calculator.invoke({"num1": 10, "operation": "+", "num2": 5})
    result2 = weather_checker.invoke({"city": "åŒ—äº¬"})
    return f"è®¡ç®—ç»“æœ: {result1}, å¤©æ°”: {result2}"

# Agentè‡ªåŠ¨ç¼–æ’ - æ™ºèƒ½å†³ç­–
def agent_automatic_orchestration():
    # Agentè‡ªåŠ¨åˆ†æå¹¶é€‰æ‹©åˆé€‚çš„å·¥å…·
    agent = create_agent(model, [calculator, weather_checker])
    response = agent.invoke({
        "messages": [{"role": "user", "content": "è®¡ç®—10+5ï¼Œç„¶åå‘Šè¯‰æˆ‘åŒ—äº¬å¤©æ°”"}]
    })
    return response
```

**Q2**: å¦‚ä½•ä¼˜åŒ–Agentçš„å†³ç­–å‡†ç¡®æ€§ï¼Ÿ
**A2**: ä»ä»¥ä¸‹å‡ ä¸ªç»´åº¦è¿›è¡Œä¼˜åŒ–ï¼š

```python
# 1. ç³»ç»Ÿæç¤ºè¯ä¼˜åŒ–
optimized_system_prompt = """
ä½ æ˜¯ä¸€ä¸ªç»éªŒä¸°å¯Œçš„æ™ºèƒ½åŠ©æ‰‹ï¼Œå…·å¤‡ä»¥ä¸‹èƒ½åŠ›ï¼š
1. æ•°å­¦è®¡ç®—èƒ½åŠ› - ç²¾ç¡®æ‰§è¡Œå„ç§æ•°å­¦è¿ç®—
2. ä¿¡æ¯æŸ¥è¯¢èƒ½åŠ› - è·å–å‡†ç¡®çš„å®æ—¶ä¿¡æ¯
3. é€»è¾‘æ¨ç†èƒ½åŠ› - åˆ†æå¤æ‚é—®é¢˜å¹¶åˆ¶å®šè§£å†³æ–¹æ¡ˆ

å†³ç­–åŸåˆ™ï¼š
- ä»”ç»†åˆ†æç”¨æˆ·éœ€æ±‚çš„æ ¸å¿ƒè¦ç‚¹
- ä¼˜å…ˆé€‰æ‹©æœ€ç›´æ¥æœ‰æ•ˆçš„è§£å†³æ–¹æ³•
- åœ¨ä¸ç¡®å®šæ—¶ä¸»åŠ¨è¯¢é—®æ¾„æ¸…
- ç¡®ä¿æ¯æ­¥æ‰§è¡Œçš„å‡†ç¡®æ€§å’Œå¯é æ€§
"""

# 2. å·¥å…·è´¨é‡æå‡
def enhanced_calculator(num1: float, operation: str, num2: float) -> dict:
    """å¢å¼ºç‰ˆè®¡ç®—å™¨å·¥å…·"""
    try:
        # è¯¦ç»†çš„æ“ä½œæ—¥å¿—
        print(f"ğŸ”§ æ‰§è¡Œè®¡ç®—: {num1} {operation} {num2}")
        
        # æ‰§è¡Œè®¡ç®—
        if operation == "+":
            result = num1 + num2
        elif operation == "-":
            result = num1 - num2
        elif operation == "*":
            result = num1 * num2
        elif operation == "/":
            if num2 == 0:
                return {"error": "é™¤æ•°ä¸èƒ½ä¸ºé›¶", "success": False}
            result = num1 / num2
        else:
            return {"error": f"ä¸æ”¯æŒçš„è¿ç®—ç¬¦: {operation}", "success": False}
        
        return {
            "result": result,
            "formula": f"{num1} {operation} {num2} = {result}",
            "success": True
        }
    except Exception as e:
        return {"error": str(e), "success": False}

# 3. æ‰§è¡Œç›‘æ§å’Œåé¦ˆ
def monitor_agent_execution(agent, query):
    """ç›‘æ§Agentæ‰§è¡Œè¿‡ç¨‹"""
    print(f"ğŸ” ç›‘æ§æŸ¥è¯¢: {query}")
    
    # æµå¼æ‰§è¡Œå¹¶è®°å½•æ¯ä¸ªæ­¥éª¤
    steps = []
    for step in agent.stream({"messages": [HumanMessage(query)]}, stream_mode="values"):
        msg = step['messages'][-1]
        steps.append({
            "type": msg.type,
            "content": msg.content
        })
        print(f"   æ­¥éª¤ {len(steps)}: {msg.type} - {msg.content[:50]}...")
    
    return steps
```

**Q3**: Agentæ‰§è¡Œå¤±è´¥æ—¶å¦‚ä½•å¤„ç†ï¼Ÿ
**A3**: å®ç°å®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ¢å¤æœºåˆ¶ï¼š

```python
def robust_agent_execution():
    """å¥å£®çš„Agentæ‰§è¡Œæœºåˆ¶"""
    
    def execute_with_fallback(agent, query, max_retries=3):
        """å¸¦é‡è¯•æœºåˆ¶çš„Agentæ‰§è¡Œ"""
        for attempt in range(max_retries):
            try:
                print(f"ğŸ”„ ç¬¬{attempt + 1}æ¬¡å°è¯•æ‰§è¡Œ: {query}")
                
                response = agent.invoke({
                    "messages": [{"role": "user", "content": query}]
                })
                
                # æ£€æŸ¥æ‰§è¡Œç»“æœ
                if response and "messages" in response:
                    final_message = response["messages"][-1]
                    if hasattr(final_message, 'content') and final_message.content:
                        print("âœ… æ‰§è¡ŒæˆåŠŸ")
                        return response
                
            except Exception as e:
                print(f"âŒ ç¬¬{attempt + 1}æ¬¡æ‰§è¡Œå¤±è´¥: {e}")
                
                if attempt < max_retries - 1:
                    print("â³ ç­‰å¾…åé‡è¯•...")
                    import time
                    time.sleep(2 ** attempt)  # æŒ‡æ•°é€€é¿
                else:
                    print("âŒ æ‰€æœ‰é‡è¯•éƒ½å¤±è´¥äº†")
                    
                    # é™çº§åˆ°åŸºç¡€æ¨¡å‹è°ƒç”¨
                    print("ğŸ”„ é™çº§åˆ°åŸºç¡€æ¨¡å‹è°ƒç”¨...")
                    llm = init_model()
                    fallback_response = llm.invoke(query)
                    return {"messages": [fallback_response]}
    
    # ä½¿ç”¨ç¤ºä¾‹
    agent = create_agent(init_model(), [calculator, weather_checker])
    result = execute_with_fallback(agent, "è®¡ç®— 15 * 4 å¹¶æŸ¥è¯¢ä¸Šæµ·å¤©æ°”")
    return result
```

## ğŸ† æœ€ä½³å®è·µæ€»ç»“

âœ… **æ­£ç¡®åšæ³•**ï¼š
- è®¾è®¡æ¸…æ™°çš„ç³»ç»Ÿæç¤ºè¯å®šä¹‰Agentè§’è‰²å’Œèƒ½åŠ›
- ä¸ºå·¥å…·æä¾›è¯¦ç»†çš„æè¿°å’Œå‚æ•°è¯´æ˜
- å®ç°å®Œå–„çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
- ä½¿ç”¨æµå¼è°ƒç”¨ç›‘æ§Agentå†³ç­–è¿‡ç¨‹
- æ ¹æ®å…·ä½“åœºæ™¯ä¼˜åŒ–å·¥å…·ç»„åˆ

âŒ **é¿å…åšæ³•**ï¼š
- ç³»ç»Ÿæç¤ºè¯è¿‡äºæ¨¡ç³Šæˆ–å†²çª
- å·¥å…·åŠŸèƒ½é‡å æˆ–æè¿°ä¸æ¸…
- å¿½è§†é”™è¯¯å¤„ç†å’Œè¾¹ç•Œæƒ…å†µ
- ä¸ç›‘æ§Agentæ‰§è¡Œè¿‡ç¨‹
- å·¥å…·æ•°é‡è¿‡å¤šå¯¼è‡´é€‰æ‹©å›°éš¾

## âš–ï¸ æŠ€æœ¯é€‰å‹å¯¹æ¯”

| æ–¹æ¡ˆ | è‡ªåŠ¨åŒ–ç¨‹åº¦ | å®ç°å¤æ‚åº¦ | é€‚ç”¨åœºæ™¯ | æ¨èæŒ‡æ•° |
|------|-----------|-----------|----------|----------|
| åŸºç¡€å·¥å…·è°ƒç”¨ | ä½ | ç®€å• | ç®€å•åŠŸèƒ½ | â­â­â­ |
| Agentæ™ºèƒ½ä½“ | é«˜ | ä¸­ç­‰ | å¤æ‚ä»»åŠ¡ | â­â­â­â­â­ |
| è‡ªå®šä¹‰ç¼–æ’ | ä¸­ç­‰ | å¤æ‚ | ç‰¹å®šæµç¨‹ | â­â­â­â­ |

**é€‰å‹å»ºè®®**ï¼š
- ç®€å•åŠŸèƒ½ï¼šä½¿ç”¨åŸºç¡€å·¥å…·è°ƒç”¨
- å¤æ‚ä»»åŠ¡ï¼šé€‰æ‹©Agentæ™ºèƒ½ä½“
- å›ºå®šæµç¨‹ï¼šè€ƒè™‘è‡ªå®šä¹‰ç¼–æ’

## ğŸ“ æ€»ç»“

Agentæ˜¯LangChainå®ç°æ™ºèƒ½è‡ªåŠ¨åŒ–çš„æ ¸å¿ƒç»„ä»¶ï¼š

âœ… **è‡ªä¸»å†³ç­–**ï¼šèƒ½å¤Ÿæ™ºèƒ½åˆ†æéœ€æ±‚å¹¶é€‰æ‹©åˆé€‚å·¥å…·  
âœ… **å¤šæ­¥æ‰§è¡Œ**ï¼šæ”¯æŒå¤æ‚ä»»åŠ¡çš„åˆ†æ­¥éª¤å¤„ç†  
âœ… **è¿‡ç¨‹é€æ˜**ï¼šå¯ç›‘æ§å®Œæ•´çš„å†³ç­–å’Œæ‰§è¡Œé“¾è·¯  
âœ… **çµæ´»æ‰©å±•**ï¼šæ˜“äºæ·»åŠ æ–°å·¥å…·å’ŒåŠŸèƒ½  
âœ… **é”™è¯¯æ¢å¤**ï¼šå…·å¤‡å®Œå–„çš„å¼‚å¸¸å¤„ç†æœºåˆ¶  

## ğŸ”— ç›¸å…³èµ„æº

- [LangChain Agents Documentation](https://python.langchain.com/docs/modules/agents/)
- [Agent Design Patterns](https://learn.microsoft.com/en-us/azure/cognitive-services/qnamaker/concepts/design-conversation-logic)
- [æ™ºèƒ½ä½“æ¶æ„è®¾è®¡](https://arxiv.org/abs/2308.11432)

---
*æœ¬æ•™ç¨‹æ·±å…¥è§£æäº†Agentçš„åŸºç¡€ä½¿ç”¨ã€‚ä¸‹ä¸€æœŸæˆ‘ä»¬å°†æ¢ç´¢Agentå¯¹äºå·¥å…·çš„é«˜é˜¶ä½¿ç”¨ã€‚*